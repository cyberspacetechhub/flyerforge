<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FlyerForge - Daily Post Generator | Create Professional Marketing Flyers | Cyberspace Tech Hub</title>
  <meta name="description" content="Create stunning daily marketing flyers with FlyerForge. Professional post generator with customizable templates, image editing, and instant download. Perfect for businesses and social media marketing." />
  <meta name="keywords" content="flyer generator, daily post creator, marketing flyers, social media posts, business flyers, graphic design tool, post templates, marketing automation" />
  <meta name="author" content="Cyberspace Tech Hub" />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="FlyerForge - Professional Daily Post Generator" />
  <meta property="og:description" content="Create stunning marketing flyers and social media posts with our advanced post generator. Features image editing, templates, and instant download." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://cyberspacetechhub.vercel.app" />
  <meta property="og:image" content="https://cyberspacetechhub.vercel.app/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="FlyerForge - Daily Post Generator" />
  <meta name="twitter:description" content="Create professional marketing flyers with ease" />
  <link rel="canonical" href="https://cyberspacetechhub.vercel.app/flyerforge" />
  <link rel="icon" type="image/png" href="images/flyerforge-logo2.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    :root{--green:#0b7a3b;--accent:#1a7a3b;--muted:#666;--bg:#f7f7f8;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#111;padding:28px;display:flex;justify-content:center;overflow-x:hidden}
    .app{width:100%;max-width:1100px;overflow-x:hidden}
    header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
    header img{width:50px;height:50px;border-radius:12px;object-fit:contain}
    h1{font-size:20px;margin:0}
    .controls{display:flex;flex-direction:column;gap:8px}
    select,input,button,textarea{font-size:14px;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08)}
    button{cursor:pointer}

    .layout{display:grid;grid-template-columns:450px 1fr;gap:18px}
    .description{background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06);margin-bottom:18px}
    .description h2{color:#0b7a3b;margin-bottom:15px;font-size:18px}
    .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
    .feature{padding:15px;border:1px solid #e9ecef;border-radius:8px;text-align:center;transition:all 0.2s ease}
    .feature:hover{border-color:#0b7a3b;transform:translateY(-2px);box-shadow:0 4px 12px rgba(11,122,59,0.1)}
    .feature-icon{font-size:24px;margin-bottom:8px}
    .steps{display:flex;gap:15px;margin:20px 0;flex-wrap:wrap}
    .step{flex:1;min-width:150px;padding:15px;background:#f8f9fa;border-radius:8px;text-align:center}
    .step-number{width:30px;height:30px;background:#0b7a3b;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 10px;font-weight:bold}
    .panel{background:#fff;padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}

    /* left controls */
    .day-list{display:flex;gap:6px;margin-bottom:12px}
    .day-btn{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid #eee}
    .day-btn.active{background:linear-gradient(90deg,var(--green),var(--accent));color:#fff;border:none}

    .uploader{display:flex;flex-direction:column;gap:8px}
    .preview-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .preview-grid img{width:90px;height:90px;object-fit:cover;border-radius:8px;border:1px solid #eee}

    label{font-weight:600;font-size:13px}
    .templates{display:flex;flex-direction:column;gap:8px}
    .template-btn{padding:8px;border-radius:8px;background:#fafafa;border:1px dashed #e6e6e6}

    /* right flyer preview */
    .preview-wrap{display:flex;flex-direction:column;gap:12px}
    .flyer{position:relative;width:100%;max-width:750px;background:#ffffff;box-shadow:0 6px 30px rgba(0,0,0,0.15);border-radius:16px;overflow:hidden;text-align:center;padding:30px 20px;margin:0 auto}
    .flyer::before{content:"";position:absolute;top:0;right:0;width:200px;height:200px;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23e0f2fe" opacity="0.3"/><circle cx="30" cy="30" r="20" fill="%23bbdefb" opacity="0.2"/></svg>') no-repeat top right/contain;opacity:0.25;z-index:0}
    .flyer::after{content:"";position:absolute;bottom:0;left:0;width:100px;height:100px;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="30" fill="%23c8e6c9" opacity="0.2"/></svg>') no-repeat bottom left/contain;opacity:0.15;z-index:0}
    .flyer-content{position:relative;z-index:1}
    .flyer .top{display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px}
    .flyer .logo{max-width:150px;height:auto;border-radius:12px;object-fit:contain;cursor:pointer;transition:all 0.2s ease;margin:0 auto 15px auto}
    .flyer .logo:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(0,0,0,0.1)}
    .flyer .title{width:100%}
    .flyer svg.title-svg{width:100%;max-width:520px;height:50px}
    .business-name{background:var(--green);color:#fff;padding:10px 20px;border-radius:8px;display:inline-block;font-size:18px;font-weight:600;margin:15px 0}
    .flyer .desc{font-size:16px;color:var(--muted);margin-bottom:25px;line-height:1.6;text-align:center;padding:0}
    .product-row{position:relative;min-height:200px;margin:20px 0;border:1px dashed #ddd;border-radius:8px;padding:10px}
    .product-row img,.flyer .logo{position:relative;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:all 0.2s ease;cursor:grab;min-width:60px;min-height:60px;resize:both;overflow:hidden}
    .product-row img:hover,.flyer .logo:hover{transform:scale(1.05);z-index:10;border:2px solid #6366f1}
    .product-row img:active,.flyer .logo:active{cursor:grabbing}
    .product-row img.dragging{opacity:0.7;z-index:20}
    .product-row img.selected,.flyer .logo.selected{border:2px solid #6366f1;z-index:15}
    .product-row .featured-image{border:3px solid #10b981;z-index:5}
    .resize-handle{position:absolute;bottom:0;right:0;width:15px;height:15px;background:#6366f1;cursor:se-resize;border-radius:3px 0 10px 0}
    .delete-btn{position:absolute;top:-8px;right:-8px;width:20px;height:20px;background:#ef4444;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:12px;display:none}
    .product-row img:hover .delete-btn,.flyer .logo:hover .delete-btn{display:block}
    .image-controls{position:absolute;top:-30px;right:0;display:none;gap:4px;background:#fff;padding:4px;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    .product-row img.selected + .image-controls{display:flex}
    .control-btn{padding:2px 6px;font-size:10px;border:1px solid #ddd;background:#fff;border-radius:3px;cursor:pointer}

    .tags{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0;justify-content:center}
    .tag{background:linear-gradient(90deg,var(--green),var(--accent));color:#fff;padding:4px 8px;border-radius:12px;font-size:11px;font-weight:600}

    .color-picker{width:0;height:0;opacity:0;position:absolute}
    .color-btn{width:32px;height:32px;border:2px solid #ddd;border-radius:8px;cursor:pointer;margin-left:8px;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;background:#fff}
    .color-btn:hover{transform:scale(1.1);border-color:#999;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
    .color-btn svg{width:20px;height:20px}
    .section-control{display:flex;align-items:center;gap:8px;margin-bottom:8px}

    .advert{background:linear-gradient(135deg,#fff7e6,#fef3e2);padding:14px;border-radius:10px;color:#3a2e00;border:1px solid rgba(251,191,36,0.2);box-shadow:0 2px 8px rgba(251,191,36,0.1)}
    .actions{display:flex;gap:8px;align-items:center}

    .footer{padding:12px;border-radius:8px;margin-top:8px;border:1px solid #e2e8f0}
    .footer-content{display:flex; flex-direction: column; justify-content: center; align-items: center;}
    .footer-logo{width:40px;height:40px;border-radius:6px;object-fit:contain;background:#fff;border:1px solid #ddd}
    .footer-info{display:flex; justify-content: center; align-items: center; flex-direction: column;}
    .footer-item{padding:6px 8px;border-radius:4px;border:1px solid rgba(0,0,0,0.1)}
    .footer-item strong{display:block;font-weight:600;margin-bottom:2px}
    .bg-selector{display:flex;gap:4px;margin-top:4px}
    .bg-option{width:16px;height:16px;border-radius:3px;cursor:pointer;border:2px solid transparent}
    .bg-option.active{border-color:#333}

    .small{font-size:12px;color:var(--muted)}
    
    /* Featured image styles */
    .featured-container{position:relative;display:inline-block;max-width:200px}
    .featured-img{max-width:200px;height:auto;border-radius:8px;border:2px solid #ddd}
    .crop-overlay{position:absolute;border:2px dashed #6366f1;background:rgba(99,102,241,0.1);cursor:move;display:none}
    #cropControls{display:flex}

    /* Popup styles */
    .popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;display:flex;align-items:center;justify-content:center}
    .popup{background:#fff;border-radius:16px;padding:30px;max-width:500px;width:90%;box-shadow:0 20px 40px rgba(0,0,0,0.3);position:relative;text-align:center}
    .popup-close{position:absolute;top:15px;right:20px;background:none;border:none;font-size:24px;cursor:pointer;color:#666}
    .popup h2{color:#0b7a3b;margin-bottom:15px}
    .popup-logo{width:80px;height:80px;margin:0 auto 20px;background:linear-gradient(135deg,#0b7a3b,#1a7a3b);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:bold}
    .popup-btn{background:linear-gradient(90deg,#0b7a3b,#1a7a3b);color:#fff;padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin:10px 5px;text-decoration:none;display:inline-block}
    .popup-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(11,122,59,0.3)}
    
    /* Footer branding */
    .brand-footer{background:#f8f9fa;border-top:1px solid #e9ecef;padding:20px;text-align:center;margin-top:30px}
    .brand-footer a{color:#0b7a3b;text-decoration:none;font-weight:600}
    .brand-footer a:hover{text-decoration:underline}
    .copyright{font-size:12px;color:#666;margin-top:10px}

    /* Tooltips and interactive elements */
    .tooltip{position:relative;display:inline-block}
    .tooltip .tooltiptext{visibility:hidden;width:200px;background:#333;color:#fff;text-align:center;border-radius:6px;padding:8px;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-100px;opacity:0;transition:opacity 0.3s;font-size:12px}
    .tooltip:hover .tooltiptext{visibility:visible;opacity:1}
    .help-icon{display:inline-block;width:16px;height:16px;background:#6c757d;color:#fff;border-radius:50%;text-align:center;font-size:10px;line-height:16px;margin-left:5px;cursor:help}
    .interactive-demo{background:linear-gradient(135deg,#e3f2fd,#f3e5f5);padding:15px;border-radius:8px;margin:15px 0;border-left:4px solid #0b7a3b}
    .demo-btn{background:#0b7a3b;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;margin:5px;font-size:12px}
    .demo-btn:hover{background:#1a7a3b;transform:translateY(-1px)}
    .progress-bar{width:100%;height:4px;background:#e9ecef;border-radius:2px;margin:10px 0}
    .progress-fill{height:100%;background:linear-gradient(90deg,#0b7a3b,#1a7a3b);border-radius:2px;width:0%;transition:width 0.3s ease}

    /* Template Modal */
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:none;align-items:center;justify-content:center}
    .modal-content{background:#fff;border-radius:16px;padding:30px;max-width:800px;width:90%;max-height:80vh;overflow-y:auto}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:#666}
    
    /* Response Modal */
    .response-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:3000;display:none;align-items:center;justify-content:center}
    .response-content{background:#fff;border-radius:12px;padding:25px;max-width:400px;width:90%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.3)}
    .response-icon{font-size:48px;margin-bottom:15px}
    .response-title{font-size:18px;font-weight:600;margin-bottom:10px}
    .response-message{color:#666;margin-bottom:20px;line-height:1.5}
    .response-btn{background:#0b7a3b;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:600}
    .star{opacity:0.3;transition:opacity 0.2s;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}
    .star.active{opacity:1;color:#fbbf24}
    .template-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
    .template-card{border:2px solid #e9ecef;border-radius:12px;padding:15px;cursor:pointer;transition:all 0.2s ease;text-align:center}
    .template-card:hover{border-color:#0b7a3b;transform:translateY(-2px);box-shadow:0 4px 12px rgba(11,122,59,0.1)}
    .template-preview{width:100%;height:120px;border-radius:8px;margin-bottom:10px;position:relative;overflow:hidden}
    .template-name{font-weight:600;margin-bottom:5px}
    .template-desc{font-size:12px;color:#666}
    .scratch-section{background:#f8f9fa;padding:20px;border-radius:12px;margin:20px 0;text-align:center}
    .scratch-btn{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;padding:15px 30px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px}
    .scratch-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(99,102,241,0.3)}

    /* Quick upload grid - Mobile optimized */
    .quick-img{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;cursor:pointer;border:2px solid #ddd;transition:all 0.2s ease;touch-action:manipulation}
    .quick-img:hover,.quick-img:active{border-color:#0b7a3b;transform:scale(1.05)}
    .quick-img img{width:100%;height:100%;object-fit:cover;pointer-events:none}
    .quick-options{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.9);color:#fff;padding:4px;display:none;flex-direction:column;gap:2px;border-radius:0 0 6px 6px}
    .quick-btn{background:none;border:none;color:#fff;font-size:10px;padding:6px;cursor:pointer;border-radius:3px;touch-action:manipulation;min-height:28px}
    .quick-btn:hover,.quick-btn:active{background:rgba(255,255,255,0.2);transform:scale(0.95)}
    
    @media (max-width: 768px) {
      .quick-img{width:70px;height:70px}
      .quick-btn{padding:8px;font-size:11px;min-height:32px}
      .quick-options{padding:6px;gap:3px}
    }
    
    @media (max-width: 480px) {
      .quick-img{width:60px;height:60px}
      .quick-btn{padding:10px;font-size:12px;min-height:36px}
      .quick-options{padding:8px;gap:4px}
    }

    /* responsive */
    @media (max-width:980px){
      .layout{grid-template-columns:1fr}
      body{padding:15px}
      .flyer{padding:20px 15px}
      .features{grid-template-columns:1fr}
      .steps{flex-direction:column}
      .day-list{flex-wrap:wrap}
      .actions{flex-wrap:wrap;justify-content:center}
      .section-control{flex-wrap:wrap}
      h1{font-size:18px}
      header img{width:40px;height:40px}
      .flyer svg.title-svg{max-width:100%}
      .modal-content{margin:10% auto;padding:20px;max-width:90%}
    }
    
    @media (max-width:640px){
      header{flex-direction:column;gap:10px;text-align:center}
      header > div:last-child{order:-1;margin-bottom:10px}
      body{padding:5px;overflow-x:hidden}
      .app{max-width:100vw;overflow-x:hidden;width:100vw}
      .panel{padding:6px;width:100%;box-sizing:border-box}
      .flyer{padding:10px 6px;max-width:100%;width:100%;box-sizing:border-box}
      .preview-grid img{width:50px;height:50px}
      .feature{padding:8px}
      .step{padding:8px}
      .description{padding:10px;width:100%;box-sizing:border-box}
      .flyer .logo{max-width:80px}
      .product-row{min-height:120px;width:100%;box-sizing:border-box}
      .tags{justify-content:flex-start;flex-wrap:wrap}
      .footer-content{padding:6px}
      header img{width:30px;height:30px}
      .controls{gap:4px;width:100%}
      h1{font-size:16px;word-wrap:break-word}
      .modal-content{margin:5% auto;padding:15px;max-width:95vw;max-height:90vh;box-sizing:border-box}
      .response-content{padding:15px;max-width:95vw;box-sizing:border-box}
      .response-icon{font-size:36px}
      .response-title{font-size:16px}
      .quick-img{width:60px;height:60px}
      input,select,textarea,button{max-width:100%;box-sizing:border-box}
    }
    
    @media (max-width:414px){
      body{padding:3px;overflow-x:hidden}
      .app{width:100vw;max-width:100vw}
      .panel{padding:4px;width:100%;box-sizing:border-box}
      .flyer{padding:8px 4px;width:100%;box-sizing:border-box}
      .description{padding:8px;width:100%;box-sizing:border-box}
      h1{font-size:14px;word-wrap:break-word;hyphens:auto}
      .small{font-size:11px}
      header img{width:25px;height:25px}
      .day-btn{padding:4px 6px;font-size:11px}
      .feature-icon{font-size:18px}
      .step-number{width:22px;height:22px;font-size:11px}
      .modal-content{padding:10px;margin:2% auto;max-width:98vw;box-sizing:border-box}
      .response-content{padding:10px;max-width:98vw;box-sizing:border-box}
      .template-grid{grid-template-columns:1fr;gap:8px}
      .quick-img{width:45px;height:45px}
      .preview-grid img{width:35px;height:35px}
      input,select,textarea{font-size:12px;padding:6px}
      header > div:last-child a{padding:6px 10px;font-size:11px}
    }
    
    @media (max-width:280px){
      body{padding:2px;overflow-x:hidden}
      .app{width:100vw;max-width:100vw}
      h1{font-size:11px;word-wrap:break-word;hyphens:auto}
      .panel{padding:3px;width:100%;box-sizing:border-box}
      .flyer{padding:6px 3px;width:100%;box-sizing:border-box}
      .description{padding:6px;width:100%;box-sizing:border-box}
      header img{width:18px;height:18px}
      .modal-content{padding:6px;margin:1% auto;font-size:11px;max-width:99vw;box-sizing:border-box}
      .response-content{padding:6px;font-size:11px;max-width:99vw;box-sizing:border-box}
      .day-btn{padding:3px 5px;font-size:9px}
      .quick-img{width:35px;height:35px}
      input,select,textarea{font-size:10px;padding:4px}
      .small{font-size:9px}
    }
    
    /* Loader animation */
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}} 
  </style>
</head>
<body>
  <!-- Page Loader -->
  <div id="pageLoader" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column">
    <img src="images/flyerforge-logo2.png" alt="FlyerForge" style="width:80px;height:80px;margin-bottom:20px;animation:pulse 2s infinite" />
    <div style="width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #0b7a3b;border-radius:50%;animation:spin 1s linear infinite"></div>
    <p style="margin-top:20px;color:#0b7a3b;font-weight:600">Loading FlyerForge...</p>
  </div>
  
  <div class="app">
    <header>
      <img src="images/flyerforge-logo2.png" alt="">
      <div class="controls">
        <h1>FlyerForge - Professional Daily Post Generator</h1>
        <small class="small">Create stunning marketing flyers and social media posts with advanced editing tools.</small>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <a href="ai-generator.html" style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:10px 16px;border-radius:25px;text-decoration:none;font-weight:600;font-size:14px;box-shadow:0 4px 12px rgba(102,126,234,0.3);transition:all 0.3s ease;display:flex;align-items:center;gap:6px" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          🤖 Ask Cyberspace AI
        </a>
      </div>
    </header>
    
    <!-- Description Section -->
    <div class="description">
      <h2>🚀 Create Professional Marketing Flyers in Minutes</h2>
      <p>FlyerForge is your complete solution for creating eye-catching daily posts and marketing flyers. Perfect for businesses, social media managers, and content creators.</p>
      
      <div class="features">
        <div class="feature">
          <div class="feature-icon">🎨</div>
          <h4>Advanced Design Tools</h4>
          <p>Image cropping, background removal, and positioning</p>
        </div>
        <div class="feature">
          <div class="feature-icon">📅</div>
          <h4>Daily Organization</h4>
          <p>Organize content by days of the week</p>
        </div>
        <div class="feature" onclick="window.open('ai-generator.html','_blank')" style="cursor:pointer;border:2px solid #667eea">
          <div class="feature-icon">🤖</div>
          <h4>AI-Powered Assistant</h4>
          <p>Chat with AI to create flyers and get help</p>
        </div>
        <div class="feature">
          <div class="feature-icon">⬇️</div>
          <h4>Instant Download</h4>
          <p>Export high-quality images ready for posting</p>
        </div>
      </div>
      
      <h3>How It Works:</h3>
      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <h4>Setup Business</h4>
          <p>Add your business details and logo</p>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <h4>Upload Images</h4>
          <p>Add featured and product images</p>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <h4>Customize Content</h4>
          <p>Edit text, colors, and layout</p>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <h4>Download & Share</h4>
          <p>Export and post to social media</p>
        </div>
      </div>
    </div>

    <div class="layout">
      <aside class="panel">
        <div class="day-list" id="dayList"></div>

        <div style="margin-top:8px">
          <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap">
            <button onclick="window.open('templates.html','_blank')" style="background:#8b5cf6;color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:11px;flex:1;min-width:0">🎨 Browse Templates</button>
            <button onclick="openTemplateModal()" style="background:#6366f1;color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:11px;flex:1;min-width:0">⚡ Quick Templates</button>
          </div>
          <div style="display:flex;gap:6px;margin-bottom:10px">
            <a href="ai-generator.html" style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:11px;flex:1;text-decoration:none;text-align:center;font-weight:600">🤖 AI Generator</a>
            <button onclick="startFromScratch()" style="background:#ef4444;color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:11px;flex:1">✨ Start Fresh</button>
          </div>
          <label>Business Setup 
            <span class="tooltip help-icon">?
              <span class="tooltiptext">Enter your business information to personalize your flyers</span>
            </span>
          </label>
          <div class="interactive-demo">
            <p><strong>💡 Quick Start:</strong></p>
            <button class="demo-btn" onclick="demoFillBusiness()">Try Demo Business</button>
            <button class="demo-btn" onclick="clearBusiness()">Clear All</button>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <input id="businessNameInput" placeholder="Your Business Name" />
            <select id="businessTypeSelect">
              <option value="">Select Business Type</option>
              <option value="restaurant">Restaurant/Food</option>
              <option value="retail">Retail/Shopping</option>
              <option value="tech">Technology/Software</option>
              <option value="health">Health/Fitness</option>
              <option value="beauty">Beauty/Salon</option>
              <option value="education">Education/Training</option>
              <option value="real-estate">Real Estate</option>
              <option value="automotive">Automotive</option>
              <option value="finance">Finance/Banking</option>
              <option value="travel">Travel/Tourism</option>
              <option value="electronics">Electronics</option>
              <option value="gadgets">Gadgets</option>
              <option value="smart-gadgets">Smart Gadgets</option>
              <option value="phone-accessories">Phone & Accessories</option>
              <option value="cryptocurrency">Cryptocurrency</option>
              <option value="home-essentials">Home Essentials</option>
              <option value="office-supplies">Office Supplies</option>
              <option value="sports-equipment">Sports Equipment</option>
              <option value="books-media">Books & Media</option>
              <option value="jewelry">Jewelry & Accessories</option>
            </select>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div style="margin-top:8px">
          <label>Upload business logo 
            <span class="tooltip help-icon">?
              <span class="tooltiptext">Add your logo to appear in header and footer of flyers</span>
            </span>
          </label>
          <div class="uploader">
            <input type="file" id="logoInput" accept="image/*" />
            <div class="small">Upload your business logo (appears in header and footer)</div>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div style="margin-top:8px">
          <label>Featured Images 
            <span class="tooltip help-icon">?
              <span class="tooltiptext">Upload multiple featured images. Click images in flyer to resize or drag to reposition.</span>
            </span>
          </label>
          <div class="uploader">
            <input type="file" id="featuredInput" accept="image/*" multiple />
            <div class="small">Upload featured images for today's post</div>
            <div id="featuredPreview" style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px"></div>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div style="margin-top:8px">
          <label>Upload product images for selected day 
            <span class="tooltip help-icon">?
              <span class="tooltiptext">Add multiple product images. Drag and drop to reposition them in the flyer.</span>
            </span>
          </label>
          <div class="uploader">
            <input type="file" id="fileInput" accept="image/*" multiple />
            <div class="small">Tip: you can upload many images; they are saved per-day in localStorage (browser).</div>
            <div class="preview-grid" id="previewGrid"></div>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div>
          <div class="section-control">
            <label>Headline Section</label>
            <input type="color" class="color-picker" id="headlineColorPicker" value="#0b7a3b" />
            <div class="color-btn" onclick="document.getElementById('headlineColorPicker').click()">
              <i class="bi bi-eyedropper"></i>
            </div>
            <button onclick="document.execCommand('bold')" style="margin-left:4px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><b>B</b></button>
            <button onclick="document.execCommand('italic')" style="margin-left:2px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><i>I</i></button>
          </div>
          <div class="templates" id="templates">
            <div class="template-btn">Fresh deals this <span id="tmpl-day">Monday</span> — grab yours today!</div>
            <div class="template-btn">Special offer for <span id="tmpl-day2">Monday</span> only — limited stock.</div>
            <div class="template-btn">Top picks for <span id="tmpl-day3">Monday</span> — trending now.</div>
          </div>
          <div style="margin-top:8px">
            <input id="headlineInput" placeholder="Custom headline (appears on image)" />
            <button id="aiHeadlineBtn" style="margin-top:4px;background:#6366f1;color:#fff;border:none;font-size:12px">🤖 AI Generate</button>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div>
          <div class="section-control">
            <label>Subline Section</label>
            <input type="color" class="color-picker" id="sublineColorPicker" value="#666666" />
            <div class="color-btn" onclick="document.getElementById('sublineColorPicker').click()">
              <i class="bi bi-eyedropper"></i>
            </div>
            <button onclick="document.execCommand('bold')" style="margin-left:4px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><b>B</b></button>
            <button onclick="document.execCommand('italic')" style="margin-left:2px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><i>I</i></button>
          </div>
          <input id="sublineInput" placeholder="e.g., Step into October with fresh opportunities..." />
          <button id="aiSublineBtn" style="margin-top:4px;background:#6366f1;color:#fff;border:none;font-size:12px">🤖 AI Generate</button>
          <div class="small">Short descriptive text under the headline</div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div>
          <div class="section-control">
            <label>Tags Section</label>
            <input type="color" class="color-picker" id="tagsColorPicker" value="#0b7a3b" />
            <div class="color-btn" onclick="document.getElementById('tagsColorPicker').click()">
              <i class="bi bi-eyedropper"></i>
            </div>
            <button onclick="document.execCommand('bold')" style="margin-left:4px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><b>B</b></button>
            <button onclick="document.execCommand('italic')" style="margin-left:2px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><i>I</i></button>
          </div>
          <input id="tagsInput" placeholder="e.g., newday, newvideo, trending" />
          <button id="aiTagsBtn" style="margin-top:4px;background:#6366f1;color:#fff;border:none;font-size:12px">🤖 AI Generate</button>
          <div class="small">Add hashtags or keywords for your post</div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div>
          <div class="section-control">
            <label>Advert Section</label>
            <input type="color" class="color-picker" id="advertColorPicker" value="#3a2e00" />
            <div class="color-btn" onclick="document.getElementById('advertColorPicker').click()">
              <i class="bi bi-eyedropper"></i>
            </div>
            <button onclick="document.execCommand('bold')" style="margin-left:4px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><b>B</b></button>
            <button onclick="document.execCommand('italic')" style="margin-left:2px;padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer"><i>I</i></button>
          </div>
          <textarea id="advertInput" rows="4" placeholder="Short advert like: We build modern websites — enquire now!" style="resize:vertical"></textarea>
          <div style="display:flex;gap:4px;margin-top:8px">
            <button id="generateAdvertBtn" style="background:var(--accent);color:#fff;border:none;font-size:12px">Generate Dynamic</button>
            <button id="aiAdvertBtn" style="background:#6366f1;color:#fff;border:none;font-size:12px">🤖 AI Generate</button>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

        <div>
          <label>Footer Content</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
            <input id="addressInput" placeholder="123 Business St, City" />
            <input id="contactInput" placeholder="+1 (555) 123-4567" />
            <input id="emailInput" placeholder="info@business.com" />
            <input id="websiteInput" placeholder="www.business.com" />
          </div>
          <div class="section-control">
            <label>Footer Background</label>
            <input type="color" class="color-picker" id="footerColorPicker" value="#0b7a3b" />
            <div class="color-btn" onclick="document.getElementById('footerColorPicker').click()">
              <i class="bi bi-eyedropper"></i>
            </div>
          </div>
          <div class="small">Business information that appears in the footer</div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="generateBtn">Generate Headline</button>
          <button id="saveBtn">Save Day Data</button>
          <button id="clearBtn">Clear Day Images</button>
        </div>
        
        <div style="margin-top:8px">
          <label>Image Layout 
            <span class="tooltip help-icon">?
              <span class="tooltiptext">Choose from preset layouts or drag images manually for custom positioning</span>
            </span>
          </label>
          <div style="display:flex;gap:4px;margin-top:4px">
            <button id="scatterBtn" style="font-size:12px;padding:4px 8px" title="Randomly scatter images">🎲 Scatter</button>
            <button id="stackBtn" style="font-size:12px;padding:4px 8px" title="Stack images in a pile">📚 Stack</button>
            <button id="circleBtn" style="font-size:12px;padding:4px 8px" title="Arrange in a circle">⭕ Circle</button>
            <button id="resetLayoutBtn" style="font-size:12px;padding:4px 8px" title="Reset to default positions">↺ Reset</button>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
          </div>
          <div class="small">Progress: <span id="progressText">0% Complete</span></div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Saved data is stored in your browser. Use the download button on the right to export the post image.</div>
        </div>
      </aside>

      <main class="panel preview-wrap">
        <div class="flyer" id="flyer">
          <div class="flyer-content">
            <div class="top">
              <img src="your-logo.png" alt="logo" class="logo" id="flyerLogo">
              
              <div class="title">
                <!-- SVG headline (keeps gradients when exported) -->
                <svg class="title-svg" viewBox="0 0 1000 120" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <linearGradient id="g1" x1="0" x2="1">
                      <stop offset="0" stop-color="#0b7a3b" id="headlineColor1" />
                    <stop offset="1" stop-color="#1a7a3b" id="headlineColor2" />
                    </linearGradient>
                  </defs>
                  <text id="svgHeadline" x="50%" y="70" text-anchor="middle" font-size="48" font-weight="800" fill="url(#g1)">WELCOME</text>
                </svg>
              </div>
              <div class="business-name" id="flyerTags" style="font-size:18px;font-weight:600">New Month • New Dreams • New Goals</div>
            </div>

          <div class="desc" id="flyerDesc">Step into October with fresh opportunities and new possibilities.<br> May this month bring growth, innovation, and joy to you!</div>

          <!-- <div class="tags" id="flyerTags">
            <span class="tag">newday</span>
            <span class="tag">newvideo</span>
          </div> -->

          <div class="product-row" id="flyerProducts"></div>

          <div class="advert" id="flyerAdvert">Advert message will appear here. E.g. We build modern websites — enquire now!</div>

            <div class="footer" id="flyerFooter" style="background:linear-gradient(90deg,var(--green),#1a7a3b);color:#fff;padding:20px;margin-top:30px;border-radius:12px;text-align:left">
              <div class="footer-content">
                  <h1 id="businessNameDisplay" style="margin-bottom: 10px;">Your business name</h1>
                <div class="footer-info" style="font-size:14px;line-height:1.6">
                  <div class="footer-item" id="footerAddress" style="margin-bottom:8px;background:none;border:none;padding:0">
                    <strong style="display:inline;font-weight:600;margin-right:8px">Address:</strong>
                    <span>123 Business St, City</span>
                  </div>
                  <div class="footer-item" id="footerContact" style="margin-bottom:8px;background:none;border:none;padding:0">
                    <strong style="display:inline;font-weight:600;margin-right:8px">Phone:</strong>
                    <span>+1 (555) 123-4567</span>
                  </div>
                  <div class="footer-item" id="footerEmail" style="margin-bottom:8px;background:none;border:none;padding:0">
                    <strong style="display:inline;font-weight:600;margin-right:8px">Email:</strong>
                    <span>info@business.com</span>
                  </div>
                  <div class="footer-item" id="footerWebsite" style="margin-bottom:8px;background:none;border:none;padding:0">
                    <strong style="display:inline;font-weight:600;margin-right:8px">Website:</strong>
                    <span>www.business.com</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div style="background:#f8f9fa;padding:15px;border-radius:8px;margin:15px 0;text-align:center">
          <h4 style="margin:0 0 10px 0;color:#0b7a3b">📸 Creator Tools</h4>
          
          <div style="background:#fff;padding:12px;border-radius:8px;margin-bottom:12px;border:2px dashed #0b7a3b">
            <label for="quickUpload" style="display:block;cursor:pointer;padding:8px;background:#0b7a3b;color:#fff;border-radius:6px;margin-bottom:8px;font-size:14px;font-weight:600">📤 Upload Images (Max 10)</label>
            <input type="file" id="quickUpload" accept="image/*" multiple style="display:none" />
            <div style="font-size:11px;color:#666">JPG, PNG, WebP • Max 5MB each</div>
          </div>
          
          <div style="background:#fff;padding:12px;border-radius:8px;margin-bottom:12px;border:1px solid #ddd">
            <h5 style="margin:0 0 8px 0;color:#0b7a3b;font-size:13px">🎨 Background Tools</h5>
            <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
              <label for="backgroundUpload" style="background:#3b82f6;color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:11px;flex:1;min-width:100px">🖼️ Upload BG</label>
              <input type="file" id="backgroundUpload" accept="image/*" style="display:none" />
              <button onclick="removeBackground()" style="background:#ef4444;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:11px;flex:1;min-width:100px">🗑️ Remove BG</button>
            </div>
          </div>
          
          <div style="background:#fff;padding:12px;border-radius:8px;margin-bottom:12px;border:1px solid #ddd">
            <h5 style="margin:0 0 8px 0;color:#0b7a3b;font-size:13px">⚡ Advanced Tools</h5>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px">
              <button onclick="openColorPalette()" style="background:#8b5cf6;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">🎨 Colors</button>
              <button onclick="openFontSelector()" style="background:#f59e0b;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">🔤 Fonts</button>
              <button onclick="openEffectsPanel()" style="background:#10b981;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">✨ Effects</button>
              <button onclick="openLayoutGrid()" style="background:#ef4444;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">📐 Layout</button>
              <button onclick="addTextBox()" style="background:#6366f1;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">📝 Add Text</button>
              <button onclick="toggleSectionMode()" style="background:#f59e0b;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px">🗑️ Remove</button>
              <button onclick="undo()" style="background:#6c757d;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px" title="Undo (Ctrl+Z)">↶ Undo</button>
              <button onclick="redo()" style="background:#6c757d;color:#fff;padding:8px;border:none;border-radius:6px;cursor:pointer;font-size:10px" title="Redo (Ctrl+Y)">↷ Redo</button>
            </div>
          </div>
          
          <div style="font-size:12px;color:#666;margin-bottom:10px">💡 <strong>Mobile Tip:</strong> Tap images to show options. Use slider to resize.</div>
          <div id="quickUploadGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:8px;margin-top:10px"></div>
        </div>
        
        <div style="display:flex;justify-content:flex-end;align-items:center;margin-top:8px">
          <div class="actions">
            <button id="downloadBtn" style="background:linear-gradient(90deg,#0b7a3b,#1a7a3b);color:#fff;padding:10px 16px;border-radius:10px;border:none;font-weight:600;box-shadow:0 4px 12px rgba(11,122,59,0.3)">⬇️ Download Image</button>
          </div>
        </div>

        <div style="display:flex;gap:6px;justify-content:space-between;margin-top:10px;align-items:center;flex-wrap:wrap">
          <div style="display:flex;gap:4px;flex-wrap:wrap">
            <button id="previewBtn" style="background:#6366f1;color:#fff;padding:6px 10px;border:none;border-radius:6px;font-size:12px">👁️ Preview</button>
            <button id="templatesBtn" style="background:#8b5cf6;color:#fff;padding:6px 10px;border:none;border-radius:6px;font-size:12px">🎨 Templates</button>
            <button id="scratchBtn" style="background:#ef4444;color:#fff;padding:6px 10px;border:none;border-radius:6px;font-size:12px">✨ New Design</button>
          </div>
          <div style="display:flex;gap:4px;flex-wrap:wrap">
            <button id="todayBtn" style="font-size:12px;padding:6px 10px">Load Today's Day</button>
            <button id="prevDay" style="font-size:12px;padding:6px 8px">◀ Prev</button>
            <button id="nextDay" style="font-size:12px;padding:6px 8px">Next ▶</button>
          </div>
        </div>
        
        <!-- Quick Stats -->
        <div style="background:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;text-align:center">
          <h4 style="margin:0 0 10px 0;color:#0b7a3b">📈 Your FlyerForge Stats</h4>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;font-size:12px">
            <div><strong id="flyersCreated">0</strong><br>Flyers Created</div>
            <div><strong id="imagesUploaded">0</strong><br>Images Uploaded</div>
            <div><strong id="daysActive">1</strong><br>Days Active</div>
          </div>
        </div>
      </main>
    </div>
    
    <!-- Premium Features Banner -->
    <div style="background:linear-gradient(135deg,#0b7a3b,#1a7a3b);color:#fff;padding:20px;border-radius:12px;margin:20px 0;text-align:center">
      <h3 style="margin:0 0 10px 0">🎆 100% FREE Forever - No Limits!</h3>
      <p style="margin:0 0 15px 0">Professional flyer creation tool by Cyberspace Tech Hub</p>
      <div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap;font-size:14px">
        <span>✓ Unlimited Flyers</span>
        <span>✓ All Features Included</span>
        <span>✓ No Watermarks</span>
        <span>✓ High-Quality Downloads</span>
        <span>✓ Commercial Use OK</span>
      </div>
    </div>
    
    <!-- Customer Reviews Section -->
    <div style="background:#f8f9fa;padding:20px;border-radius:12px;margin:20px 0;text-align:center">
      <h3 style="margin:0 0 15px 0;color:#0b7a3b">💬 What Our Customers Say</h3>
      
      <!-- Testimonials Slider -->
      <div style="position:relative;overflow:hidden;border-radius:8px;background:#fff;margin:15px 0;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
        <div id="testimonialsSlider" style="display:flex;transition:transform 0.5s ease"></div>
        <div style="text-align:center;margin:10px 0">
          <button onclick="prevTestimonial()" style="background:#0b7a3b;color:#fff;border:none;padding:5px 10px;margin:0 5px;border-radius:4px;cursor:pointer;font-size:12px">←</button>
          <button onclick="nextTestimonial()" style="background:#0b7a3b;color:#fff;border:none;padding:5px 10px;margin:0 5px;border-radius:4px;cursor:pointer;font-size:12px">→</button>
        </div>
      </div>
      
      <div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap">
        <button onclick="openReviewModal()" style="background:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;transition:all 0.3s ease">📝 Leave a Review</button>
        <button onclick="openDrinkModal()" style="background:#f59e0b;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;transition:all 0.3s ease">☕ Buy Us a Drink</button>
      </div>
      <p style="margin:10px 0 0 0;font-size:12px;color:#666">Enjoying our free tool? Help us keep improving!</p>
    </div>
    
    <!-- Brand Footer -->
    <div class="brand-footer">
      <p>Crafted with ❤️ by <a href="https://cyberspacetechhub.vercel.app" target="_blank">Cyberspace Tech Hub</a> | <strong>FlyerForge</strong> - Your Free Marketing Companion</p></p>
      <div class="copyright">
        © 2024 Cyberspace Tech Hub. All rights reserved. | FlyerForge - Professional Marketing Tools<br>
        <small>Share this tool: <a href="#" onclick="shareApp()" style="color:#0b7a3b">🔗 Copy Link</a> | 
        <a href="https://twitter.com/intent/tweet?text=Check%20out%20FlyerForge%20-%20Free%20professional%20flyer%20creator!&url=https://cyberspacetechhub.vercel.app" target="_blank" style="color:#0b7a3b">🐦 Tweet</a></small>
      </div>
    </div>
  </div>
  
  <!-- Template Modal -->
  <div class="modal" id="templateModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>🎨 Choose Your Template</h2>
        <button class="modal-close" onclick="closeTemplateModal()">&times;</button>
      </div>
      
      <div class="scratch-section">
        <h3>✨ Start from Scratch</h3>
        <p>Create your own unique design with complete creative control - perfect for learning and practice</p>
        <button class="scratch-btn" onclick="startBlankTemplate()">🎨 Blank Canvas</button>
        <p style="font-size:12px;color:#666;margin-top:10px">Like Canva or Photoshop - add images, text, and content anywhere you want</p>
      </div>
      
      <h3>📄 Professional Templates</h3>
      <div class="template-grid" id="templateGrid"></div>
    </div>
  </div>
  
  <!-- Response Modal -->
  <div class="response-modal" id="responseModal">
    <div class="response-content">
      <div class="response-icon" id="responseIcon"></div>
      <div class="response-title" id="responseTitle"></div>
      <div class="response-message" id="responseMessage"></div>
      <button class="response-btn" onclick="closeResponseModal()">OK</button>
    </div>
  </div>
  
  <!-- Review Modal -->
  <div class="modal" id="reviewModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>📝 Leave a Review</h2>
        <button class="modal-close" onclick="closeReviewModal()">&times;</button>
      </div>
      <form onsubmit="submitReview(event)">
        <div style="margin-bottom:15px">
          <label style="display:block;margin-bottom:5px;font-weight:bold">Your Name:</label>
          <input type="text" id="reviewName" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px">
        </div>
        <div style="margin-bottom:15px">
          <label style="display:block;margin-bottom:5px;font-weight:bold">Email:</label>
          <input type="email" id="reviewEmail" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px">
        </div>
        <div style="margin-bottom:15px">
          <label style="display:block;margin-bottom:5px;font-weight:bold">Phone:</label>
          <input type="tel" id="reviewPhone" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px">
        </div>
        <div style="margin-bottom:15px">
          <label style="display:block;margin-bottom:5px;font-weight:bold">Rating:</label>
          <div class="star-rating" style="font-size:24px;cursor:pointer">
            <span class="star" data-rating="1" style="opacity:0.3;transition:opacity 0.2s">⭐</span>
            <span class="star" data-rating="2" style="opacity:0.3;transition:opacity 0.2s">⭐</span>
            <span class="star" data-rating="3" style="opacity:0.3;transition:opacity 0.2s">⭐</span>
            <span class="star" data-rating="4" style="opacity:0.3;transition:opacity 0.2s">⭐</span>
            <span class="star" data-rating="5" style="opacity:0.3;transition:opacity 0.2s">⭐</span>
          </div>
        </div>
        <div style="margin-bottom:15px">
          <label style="display:block;margin-bottom:5px;font-weight:bold">Your Review:</label>
          <textarea id="reviewText" rows="4" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;resize:vertical"></textarea>
        </div>
        <button type="submit" style="background:#10b981;color:#fff;padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-size:16px;width:100%">Submit Review</button>
      </form>
    </div>
  </div>
  
  <!-- Drink Modal -->
  <div class="modal" id="drinkModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>☕ Buy Us a Drink</h2>
        <button class="modal-close" onclick="closeDrinkModal()">&times;</button>
      </div>
      <p style="text-align:center;margin-bottom:20px">Enjoying our free tool? Help us keep the lights on with a small donation!</p>
      <div style="display:flex;flex-direction:column;gap:10px;margin:20px 0">
        <button onclick="selectPayment('bank')" style="padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;font-size:16px;transition:all 0.3s ease">🏦 Bank Transfer</button>
        <button onclick="selectPayment('crypto')" style="padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;font-size:16px;transition:all 0.3s ease">₿ Cryptocurrency</button>
        <button onclick="selectPayment('international')" style="padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;font-size:16px;transition:all 0.3s ease">🌍 International Account</button>
      </div>
      <div id="paymentDetails" style="margin-top:20px;padding:15px;background:#f8fafc;border-radius:8px;display:none"></div>
    </div>
  </div>
  
  <!-- Promotional Popup -->
  <div class="popup-overlay" id="promoPopup">
    <div class="popup">
      <button class="popup-close" onclick="closePopup()">&times;</button>
      <div class="popup-logo">CTH</div>
      <h2>Welcome to FlyerForge!</h2>
      <p><strong>Powered by Cyberspace Tech Hub</strong></p>
      <p>Discover our complete suite of digital solutions:</p>
      <ul style="text-align:left;margin:20px 0">
        <li>🚀 Web Development & Design</li>
        <li>📱 Mobile App Development</li>
        <li>🎨 Graphic Design & Branding</li>
        <li>📊 Digital Marketing Solutions</li>
        <li>🛠️ Custom Software Development</li>
        <li>☁️ Cloud Services & Hosting</li>
      </ul>
      <p>Transform your business with cutting-edge technology!</p>
      
      <div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:15px;border-radius:12px;margin:15px 0;color:#fff">
        <h4 style="margin:0 0 8px 0;font-size:16px">🤖 NEW: AI-Powered Flyer Creation!</h4>
        <p style="margin:0 0 10px 0;font-size:13px">Chat with our AI to create custom flyers instantly. Ask questions, get help, or generate designs!</p>
        <a href="ai-generator.html" style="background:#fff;color:#667eea;padding:8px 16px;border-radius:20px;text-decoration:none;font-weight:600;font-size:12px;display:inline-block">Try AI Generator →</a>
      </div>
      
      <a href="https://cyberspacetechhub.vercel.app" target="_blank" class="popup-btn">Visit Our Website</a>
      <button onclick="closePopup()" class="popup-btn" style="background:#6c757d">Continue to FlyerForge</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // DAYS array and simple state
    const DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
    let currentDayIndex = 0;

    // Utilities for localStorage keying
    function storageKey(day){ return 'daily-posts-'+day }

    // init day buttons
    const dayList = document.getElementById('dayList');
    DAYS.forEach((d,i)=>{
      const btn = document.createElement('button');
      btn.textContent = d.slice(0,3);
      btn.className = 'day-btn';
      if(i===0) btn.classList.add('active');
      btn.addEventListener('click', ()=>{ setDay(i) });
      dayList.appendChild(btn);
    });

    function setDay(i){
      currentDayIndex = i;
      // update active
      document.querySelectorAll('.day-btn').forEach((b,idx)=> b.classList.toggle('active', idx===i));
      // update template placeholders
      document.querySelectorAll('#tmpl-day, #tmpl-day2, #tmpl-day3').forEach(el=>el.textContent = DAYS[i]);
      // load data
      loadDayData();
    }

    // file upload handling
    const fileInput = document.getElementById('fileInput');
    const previewGrid = document.getElementById('previewGrid');
    fileInput.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files);
      const images = await Promise.all(files.map(f => fileToDataURL(f)));
      const key = storageKey(DAYS[currentDayIndex]);
      const existing = JSON.parse(localStorage.getItem(key)||'{}');
      existing.images = (existing.images||[]).concat(images);
      localStorage.setItem(key, JSON.stringify(existing));
      renderPreviews();
      renderFlyerProducts();
      fileInput.value = '';
      incrementStat('images');
    });

    function fileToDataURL(file){
      return new Promise(res=>{
        const reader = new FileReader();
        reader.onload = ()=>res(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function renderPreviews(){
      const key = storageKey(DAYS[currentDayIndex]);
      const data = JSON.parse(localStorage.getItem(key)||'{}');
      previewGrid.innerHTML = '';
      (data.images||[]).forEach((src,idx)=>{
        const img = document.createElement('img'); img.src = src; img.alt = 'img'+idx;
        img.addEventListener('click', ()=>{ // remove on click
          if(!confirm('Remove this image from day '+DAYS[currentDayIndex]+'?')) return;
          data.images.splice(idx,1);
          localStorage.setItem(key, JSON.stringify(data));
          renderPreviews(); renderFlyerProducts();
        });
        previewGrid.appendChild(img);
      });
    }

    // Templates and generation
    const headlineTemplates = [
      (day)=>`Fresh deals this ${day} — grab yours today!`,
      (day)=>`Special offer for ${day} only — limited stock.`,
      (day)=>`Top picks for ${day} — trending now.`,
      (day)=>`${day} specials — don't miss out!`,
      (day)=>`New arrivals this ${day} — shop now!`,
      (day)=>`${day} flash sale — limited time only!`
    ];

    const businessTemplates = {
      restaurant: {
        headlines: ['Fresh flavors this {day} — taste the difference!', 'Special menu for {day} — limited time!', '{day} chef specials — book now!'],
        sublines: ['Savor authentic flavors crafted with passion.<br>Every dish tells a story of culinary excellence!', 'Experience fine dining at its best.<br>Fresh ingredients, exceptional taste!'],
        adverts: ['Book your table today — unforgettable dining awaits!', 'Fresh ingredients, authentic flavors — taste the difference!'],
        tags: ['freshfood', 'dining', 'chef special']
      },
      retail: {
        headlines: ['New arrivals this {day} — shop the latest!', '{day} flash sale — up to 50% off!', 'Trending items this {day} — get yours!'],
        sublines: ['Discover the latest trends and timeless classics.<br>Quality fashion that defines your style!', 'Shop smart, look great, feel confident.<br>Your style journey starts here!'],
        adverts: ['Visit our store today — style meets affordability!', 'Quality products, unbeatable prices — shop now!'],
        tags: ['fashion', 'sale', 'trending']
      },
      tech: {
        headlines: ['Tech innovations this {day} — upgrade now!', '{day} digital solutions — transform your business!', 'Smart tech for {day} — stay ahead!'],
        sublines: ['Cutting-edge technology for modern solutions.<br>Innovation that drives your success forward!', 'Digital transformation made simple.<br>Technology that works for you!'],
        adverts: ['Upgrade your tech today — innovation awaits!', 'Smart solutions for modern challenges — contact us!'],
        tags: ['innovation', 'digital', 'tech']
      },
      health: {
        headlines: ['Fitness goals this {day} — start your journey!', '{day} wellness special — feel your best!', 'Health transformation {day} — join us!'],
        sublines: ['Your health is your wealth — invest in yourself.<br>Professional guidance for lasting results!', 'Transform your body, elevate your mind.<br>Wellness journey starts today!'],
        adverts: ['Start your fitness journey — professional trainers ready!', 'Achieve your health goals — expert guidance available!'],
        tags: ['fitness', 'wellness', 'health']
      },
      beauty: {
        headlines: ['Beauty treatments this {day} — look stunning!', '{day} makeover special — feel beautiful!', 'Glow up {day} — book your session!'],
        sublines: ['Enhance your natural beauty with expert care.<br>Professional treatments for radiant results!', 'Beauty that shines from within.<br>Pamper yourself, you deserve it!'],
        adverts: ['Book your beauty session — expert stylists available!', 'Look and feel amazing — professional beauty services!'],
        tags: ['beauty', 'makeover', 'glow']
      },
      electronics: {
        headlines: ['Latest electronics this {day} — upgrade now!', '{day} tech deals — save big!', 'Premium electronics {day} — shop today!'],
        sublines: ['Cutting-edge electronics for modern living.<br>Quality products with warranty guarantee!', 'Power up your life with premium electronics.<br>Innovation meets affordability!'],
        adverts: ['Shop electronics today — best prices guaranteed!', 'Quality electronics with warranty — upgrade now!'],
        tags: ['electronics', 'tech', 'gadgets']
      },
      gadgets: {
        headlines: ['Cool gadgets this {day} — must-have items!', '{day} gadget sale — limited stock!', 'Trending gadgets {day} — get yours!'],
        sublines: ['Discover amazing gadgets that simplify life.<br>Innovation at your fingertips!', 'Smart gadgets for smart people.<br>Make life easier with our collection!'],
        adverts: ['Explore our gadgets — innovation awaits!', 'Smart gadgets, smarter prices — shop now!'],
        tags: ['gadgets', 'innovation', 'smart']
      },
      'smart-gadgets': {
        headlines: ['Smart gadgets this {day} — future is here!', '{day} smart tech — automate your life!', 'AI gadgets {day} — be ahead!'],
        sublines: ['Smart technology for intelligent living.<br>Connect, control, and automate everything!', 'Experience the future with smart gadgets.<br>Intelligence meets convenience!'],
        adverts: ['Go smart today — intelligent gadgets available!', 'Smart living starts here — explore our range!'],
        tags: ['smart', 'AI', 'automation']
      },
      'phone-accessories': {
        headlines: ['Phone accessories this {day} — protect & style!', '{day} mobile deals — cases & more!', 'Phone gear {day} — complete your setup!'],
        sublines: ['Protect and personalize your mobile device.<br>Quality accessories for every phone!', 'Style meets protection in our accessories.<br>Complete your mobile experience!'],
        adverts: ['Protect your phone — quality accessories here!', 'Mobile accessories that matter — shop now!'],
        tags: ['mobile', 'accessories', 'protection']
      },
      cryptocurrency: {
        headlines: ['Crypto insights this {day} — trade smart!', '{day} blockchain news — stay informed!', 'Digital assets {day} — invest wisely!'],
        sublines: ['Navigate the crypto world with confidence.<br>Expert guidance for digital investments!', 'Your gateway to cryptocurrency success.<br>Learn, trade, and grow your portfolio!'],
        adverts: ['Start crypto trading — expert guidance available!', 'Crypto made simple — join our community!'],
        tags: ['crypto', 'blockchain', 'trading']
      },
      'home-essentials': {
        headlines: ['Home essentials this {day} — comfort first!', '{day} home deals — upgrade your space!', 'Essential items {day} — make home better!'],
        sublines: ['Everything you need for a comfortable home.<br>Quality essentials at great prices!', 'Transform your space with our essentials.<br>Home is where comfort begins!'],
        adverts: ['Shop home essentials — comfort guaranteed!', 'Make your house a home — browse our collection!'],
        tags: ['home', 'essentials', 'comfort']
      },
      'office-supplies': {
        headlines: ['Office supplies this {day} — work efficiently!', '{day} workspace deals — boost productivity!', 'Office gear {day} — professional setup!'],
        sublines: ['Professional supplies for productive workspaces.<br>Everything you need to succeed!', 'Organize your office, organize your success.<br>Quality supplies for professionals!'],
        adverts: ['Upgrade your office — professional supplies here!', 'Work smarter with our office solutions!'],
        tags: ['office', 'productivity', 'professional']
      },
      'sports-equipment': {
        headlines: ['Sports gear this {day} — play your best!', '{day} fitness deals — stay active!', 'Athletic equipment {day} — train hard!'],
        sublines: ['Quality sports equipment for peak performance.<br>Gear up for your fitness journey!', 'Achieve your athletic goals with our gear.<br>Performance meets durability!'],
        adverts: ['Get fit with quality gear — shop sports equipment!', 'Train like a pro — premium equipment available!'],
        tags: ['sports', 'fitness', 'athletic']
      },
      'books-media': {
        headlines: ['Books & media this {day} — expand your mind!', '{day} reading deals — knowledge awaits!', 'Educational content {day} — learn more!'],
        sublines: ['Expand your knowledge with our collection.<br>Books, media, and learning resources!', 'Feed your mind with quality content.<br>Learning never stops with our selection!'],
        adverts: ['Discover new worlds — books and media here!', 'Knowledge is power — explore our library!'],
        tags: ['books', 'education', 'learning']
      },
      jewelry: {
        headlines: ['Jewelry collection this {day} — shine bright!', '{day} accessories — express yourself!', 'Premium jewelry {day} — look stunning!'],
        sublines: ['Beautiful jewelry for every occasion.<br>Express your style with our collection!', 'Elegance and beauty in every piece.<br>Find your perfect accessory today!'],
        adverts: ['Shine with our jewelry — beautiful pieces await!', 'Express your style — premium jewelry collection!'],
        tags: ['jewelry', 'fashion', 'elegant']
      }
    };

    const advertTemplates = [
      "Transform your business with our innovative solutions — contact us today!",
      "Quality products, exceptional service — your success is our priority!",
      "Join thousands of satisfied customers — experience the difference!",
      "Professional services tailored to your needs — get started now!",
      "Unlock your potential with our expert guidance — let's grow together!",
      "Premium quality at unbeatable prices — discover what we offer!"
    ];

    const sublineTemplates = [
      "Step into October with fresh opportunities and new possibilities.<br>May this month bring growth, innovation, and joy to you!",
      "Embrace the season of change with exciting new ventures.<br>Your journey to success starts here!",
      "Discover endless possibilities this month.<br>Let's create something amazing together!",
      "New month, new goals, new achievements.<br>Make every moment count!",
      "Welcome to a world of opportunities.<br>Your dreams are within reach!"
    ];

    document.getElementById('generateBtn').addEventListener('click', ()=>{
      const businessType = document.getElementById('businessTypeSelect').value;
      let h;
      if(businessType && businessTemplates[businessType]){
        const typeTemplates = businessTemplates[businessType].headlines;
        h = typeTemplates[Math.floor(Math.random()*typeTemplates.length)].replace('{day}', DAYS[currentDayIndex]);
      } else {
        h = headlineTemplates[Math.floor(Math.random()*headlineTemplates.length)](DAYS[currentDayIndex]);
      }
      document.getElementById('headlineInput').value = h;
      updateHeadline();
    });

    document.getElementById('generateAdvertBtn').addEventListener('click', ()=>{
      const businessType = document.getElementById('businessTypeSelect').value;
      let advert;
      if(businessType && businessTemplates[businessType]){
        const typeAdverts = businessTemplates[businessType].adverts;
        advert = typeAdverts[Math.floor(Math.random()*typeAdverts.length)];
      } else {
        advert = advertTemplates[Math.floor(Math.random()*advertTemplates.length)];
      }
      document.getElementById('advertInput').value = advert;
      document.getElementById('flyerAdvert').innerHTML = advert;
    });

    // Business name input
    const businessNameInput = document.getElementById('businessNameInput');
    businessNameInput.addEventListener('input', ()=>{
      const name = businessNameInput.value || 'Your Business Name';
      const businessNameEl = document.getElementById('businessNameDisplay');
      if(businessNameEl) businessNameEl.textContent = name;
    });

    // Color pickers
    document.getElementById('headlineColorPicker').addEventListener('input', (e)=>{
      document.getElementById('headlineColor1').setAttribute('stop-color', e.target.value);
      document.getElementById('headlineColor2').setAttribute('stop-color', e.target.value);
    });
    document.getElementById('sublineColorPicker').addEventListener('input', (e)=>{
      document.getElementById('flyerDesc').style.color = e.target.value;
    });
    document.getElementById('tagsColorPicker').addEventListener('input', (e)=>{
      document.querySelectorAll('.tag').forEach(tag=>{
        tag.style.background = e.target.value;
      });
    });
    document.getElementById('advertColorPicker').addEventListener('input', (e)=>{
      document.getElementById('flyerAdvert').style.color = e.target.value;
    });
    document.getElementById('footerColorPicker').addEventListener('input', (e)=>{
      document.getElementById('flyerFooter').style.background = `linear-gradient(90deg,${e.target.value},${e.target.value}dd)`;
    });

    // AI Generation functions with OpenAI integration
    async function generateAIContent(prompt, type) {
      const businessType = document.getElementById('businessTypeSelect').value;
      const businessName = document.getElementById('businessNameInput').value || 'Your Business';
      const day = DAYS[currentDayIndex];
      
      // Create context-aware prompts
      let aiPrompt = '';
      switch(type) {
        case 'headline':
          aiPrompt = `Create a catchy marketing headline for a ${businessType || 'business'} called "${businessName}" for ${day}. Make it engaging and promotional. Return only the headline text.`;
          break;
        case 'subline':
          aiPrompt = `Write a compelling subline/description for a ${businessType || 'business'} called "${businessName}". Make it professional and appealing. Return only the subline text with <br> tags for line breaks if needed.`;
          break;
        case 'tags':
          aiPrompt = `Generate 4-5 relevant hashtags/keywords for a ${businessType || 'business'} called "${businessName}". Return as comma-separated values only.`;
          break;
        case 'advert':
          aiPrompt = `Write a short promotional advertisement text for a ${businessType || 'business'} called "${businessName}". Make it compelling and include a call-to-action. Return only the ad text.`;
          break;
        default:
          return generateFallbackContent(type);
      }
      
      try {
        // Try OpenAI API first
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer YOUR_OPENAI_API_KEY_HERE'
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [{
              role: 'system',
              content: 'You are a professional marketing copywriter. Create engaging, concise marketing content.'
            }, {
              role: 'user',
              content: aiPrompt
            }],
            max_tokens: 100,
            temperature: 0.7
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          return data.choices[0].message.content.trim();
        }
      } catch (error) {
        console.log('OpenAI API not available, using fallback');
      }
      
      // Fallback to local templates
      return generateFallbackContent(type);
    }

    function generateFallbackContent(type) {
      const businessType = document.getElementById('businessTypeSelect').value;
      const businessName = document.getElementById('businessNameInput').value || 'Your Business';
      const day = DAYS[currentDayIndex];
      
      switch(type) {
        case 'headline':
          if(businessType && businessTemplates[businessType]) {
            const templates = businessTemplates[businessType].headlines;
            return templates[Math.floor(Math.random()*templates.length)].replace('{day}', day);
          }
          return `${day} Special at ${businessName} — Don't Miss Out!`;
          
        case 'subline':
          if(businessType && businessTemplates[businessType]) {
            const templates = businessTemplates[businessType].sublines;
            return templates[Math.floor(Math.random()*templates.length)];
          }
          return `Experience excellence at ${businessName}.<br>Quality service that exceeds expectations!`;
          
        case 'tags':
          if(businessType && businessTemplates[businessType]) {
            return businessTemplates[businessType].tags.join(', ');
          }
          return 'quality, service, excellence, trending';
          
        case 'advert':
          if(businessType && businessTemplates[businessType]) {
            const templates = businessTemplates[businessType].adverts;
            return templates[Math.floor(Math.random()*templates.length)];
          }
          return `Visit ${businessName} today — experience the difference!`;
          
        default:
          return null;
      }
    }

    document.getElementById('aiHeadlineBtn').addEventListener('click', async ()=>{
      const result = await generateAIContent('', 'headline');
      if(result) {
        document.getElementById('headlineInput').value = result;
        updateHeadline();
      }
    });

    document.getElementById('aiSublineBtn').addEventListener('click', async ()=>{
      const result = await generateAIContent('', 'subline');
      if(result) {
        document.getElementById('sublineInput').value = result;
        document.getElementById('flyerDesc').innerHTML = result;
      }
    });

    document.getElementById('aiTagsBtn').addEventListener('click', async ()=>{
      const result = await generateAIContent('', 'tags');
      if(result) {
        document.getElementById('tagsInput').value = result;
        const tags = result.split(',').map(t=>t.trim()).filter(t=>t);
        const container = document.getElementById('flyerTags');
        container.innerHTML = '';
        tags.forEach(tag=>{
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = tag;
          container.appendChild(span);
        });
      }
    });

    document.getElementById('aiAdvertBtn').addEventListener('click', async ()=>{
      const result = await generateAIContent('', 'advert');
      if(result) {
        document.getElementById('advertInput').value = result;
        document.getElementById('flyerAdvert').innerHTML = result;
      }
    });

    // headline input binds into SVG
    const headlineInput = document.getElementById('headlineInput');
    headlineInput.addEventListener('input', updateHeadline);
    function updateHeadline(){
      const text = headlineInput.value.trim() || (DAYS[currentDayIndex]+" Picks");
      const svgText = document.getElementById('svgHeadline');
      const svg = document.querySelector('.title-svg');
      
      svgText.textContent = text.toUpperCase();
      
      // Adjust viewBox width based on text length to prevent cutting
      const textLength = text.length;
      let viewBoxWidth = Math.max(1000, textLength * 50);
      
      // Keep font size large, just expand the container
      svgText.setAttribute('font-size', '48');
      svg.setAttribute('viewBox', `0 0 ${viewBoxWidth} 120`);
    }

    // logo upload handling
    const logoInput = document.getElementById('logoInput');
    logoInput.addEventListener('change', async (e)=>{
      if(e.target.files[0]){
        const logoData = await fileToDataURL(e.target.files[0]);
        localStorage.setItem('business-logo', logoData);
        document.getElementById('flyerLogo').src = logoData;
      }
    });

    // Featured images handling
    const featuredInput = document.getElementById('featuredInput');
    featuredInput.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files);
      const images = await Promise.all(files.map(f => fileToDataURL(f)));
      const key = storageKey(DAYS[currentDayIndex]);
      const existing = JSON.parse(localStorage.getItem(key)||'{}');
      existing.featuredImages = (existing.featuredImages||[]).concat(images);
      localStorage.setItem(key, JSON.stringify(existing));
      renderFeaturedPreviews();
      renderFlyerProducts();
      featuredInput.value = '';
    });
    
    // Quick upload handling
    let quickUploadImages = [];
    const MAX_IMAGES = 10;
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
    
    document.getElementById('quickUpload').addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files);
      
      // Check image limit
      if(quickUploadImages.length + files.length > MAX_IMAGES){
        showResponseModal('⚠️', 'Image Limit Reached', `You can only upload a maximum of ${MAX_IMAGES} images at once. Please remove some images first.`, 'warning');
        e.target.value = '';
        return;
      }
      
      // Validate files
      const validFiles = [];
      const errors = [];
      
      for(const file of files){
        if(file.size > MAX_FILE_SIZE){
          errors.push(`${file.name} is too large (max 5MB)`);
          continue;
        }
        if(!file.type.startsWith('image/')){
          errors.push(`${file.name} is not an image`);
          continue;
        }
        validFiles.push(file);
      }
      
      if(errors.length > 0){
        showResponseModal('❌', 'Upload Error', errors.join('<br>'), 'error');
      }
      
      if(validFiles.length > 0){
        const images = await Promise.all(validFiles.map(f => fileToDataURL(f)));
        quickUploadImages = quickUploadImages.concat(images);
        renderQuickUploadGrid();
        showResponseModal('✅', 'Upload Success', `${validFiles.length} image(s) uploaded successfully!`, 'success');
      }
      
      e.target.value = '';
    });
    
    function renderQuickUploadGrid(){
      const grid = document.getElementById('quickUploadGrid');
      grid.innerHTML = '';
      quickUploadImages.forEach((src,idx)=>{
        const container = document.createElement('div');
        container.className = 'quick-img';
        container.innerHTML = `
          <img src="${src}" />
          <div class="quick-options" style="display:flex;flex-direction:column;gap:2px;padding:4px;background:rgba(0,0,0,0.9);position:absolute;bottom:0;left:0;right:0;border-radius:0 0 8px 8px">
            <button class="quick-btn" onclick="makeImageFeatured('${src}', ${idx})" style="background:#10b981;color:#fff;border:none;padding:4px;border-radius:3px;font-size:10px;cursor:pointer;touch-action:manipulation">⭐ Featured</button>
            <button class="quick-btn" onclick="addToProducts('${src}', ${idx})" style="background:#3b82f6;color:#fff;border:none;padding:4px;border-radius:3px;font-size:10px;cursor:pointer;touch-action:manipulation">📦 Product</button>
            <button class="quick-btn" onclick="deleteQuickImage(${idx})" style="background:#ef4444;color:#fff;border:none;padding:4px;border-radius:3px;font-size:10px;cursor:pointer;touch-action:manipulation">🗑️ Delete</button>
          </div>
        `;
        
        container.addEventListener('click', (e) => {
          e.preventDefault();
          const options = container.querySelector('.quick-options');
          const isVisible = options.style.display === 'flex';
          
          document.querySelectorAll('.quick-options').forEach(opt => {
            if (opt !== options) opt.style.display = 'none';
          });
          
          options.style.display = isVisible ? 'none' : 'flex';
        });
        
        grid.appendChild(container);
      });
    }
    
    function makeImageFeatured(src, idx){
      const key = storageKey(DAYS[currentDayIndex]);
      const existing = JSON.parse(localStorage.getItem(key)||'{}');
      existing.featuredImages = (existing.featuredImages||[]).concat([src]);
      localStorage.setItem(key, JSON.stringify(existing));
      renderFeaturedPreviews();
      renderFlyerProducts();
      // Remove from quick upload
      quickUploadImages.splice(idx, 1);
      renderQuickUploadGrid();
    }
    
    function addToProducts(src, idx){
      const key = storageKey(DAYS[currentDayIndex]);
      const existing = JSON.parse(localStorage.getItem(key)||'{}');
      existing.images = (existing.images||[]).concat([src]);
      localStorage.setItem(key, JSON.stringify(existing));
      renderPreviews();
      renderFlyerProducts();
      incrementStat('images');
      // Remove from quick upload
      quickUploadImages.splice(idx, 1);
      renderQuickUploadGrid();
    }
    
    function deleteQuickImage(idx){
      quickUploadImages.splice(idx, 1);
      renderQuickUploadGrid();
    }
    
    // Response modal functions
    function showResponseModal(icon, title, message, type){
      document.getElementById('responseIcon').textContent = icon;
      document.getElementById('responseTitle').textContent = title;
      document.getElementById('responseMessage').innerHTML = message;
      
      const modal = document.getElementById('responseModal');
      const btn = modal.querySelector('.response-btn');
      
      if(type === 'error'){
        btn.style.background = '#ef4444';
      } else if(type === 'warning'){
        btn.style.background = '#f59e0b';
      } else {
        btn.style.background = '#0b7a3b';
      }
      
      modal.style.display = 'flex';
    }
    
    function closeResponseModal(){
      document.getElementById('responseModal').style.display = 'none';
    }
    
    // Make closeResponseModal globally available
    window.closeResponseModal = closeResponseModal;
    
    // Review modal functions
    let selectedRating = 0;
    
    function openReviewModal(){
      document.getElementById('reviewModal').style.display = 'flex';
    }
    
    function closeReviewModal(){
      document.getElementById('reviewModal').style.display = 'none';
      document.getElementById('reviewName').value = '';
      document.getElementById('reviewEmail').value = '';
      document.getElementById('reviewPhone').value = '';
      document.getElementById('reviewText').value = '';
      selectedRating = 0;
      document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
    }
    
    function submitReview(e){
      e.preventDefault();
      const name = document.getElementById('reviewName').value;
      const email = document.getElementById('reviewEmail').value;
      const phone = document.getElementById('reviewPhone').value;
      const text = document.getElementById('reviewText').value;
      
      if(selectedRating === 0){
        alert('Please select a rating');
        return;
      }
      
      fetch('https://cyberspacetechhub.onrender.com/api/feedback', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          name,
          email,
          phone,
          rating: selectedRating,
          subject: `FlyerForge Review - ${selectedRating} Stars`,
          message: text,
          site: 'flyerforge'
        })
      }).catch(()=>{});
      
      showResponseModal('✅', 'Thank You!', `Thanks ${name}! Your ${selectedRating}-star review has been submitted.`, 'success');
      closeReviewModal();
    }
    
    // Star rating functionality
    document.querySelectorAll('.star').forEach(star => {
      star.addEventListener('click', (e)=> {
        e.preventDefault();
        selectedRating = parseInt(star.dataset.rating);
        document.querySelectorAll('.star').forEach((s, idx) => {
          if(idx < selectedRating) {
            s.classList.add('active');
            s.style.opacity = '1';
            s.style.color = '#fbbf24';
          } else {
            s.classList.remove('active');
            s.style.opacity = '0.3';
            s.style.color = '';
          }
        });
      });
      
      // Prevent text selection on mobile
      star.addEventListener('touchstart', (e) => {
        e.preventDefault();
      });
    });
    
    // Drink modal functions
    function openDrinkModal(){
      document.getElementById('drinkModal').style.display = 'flex';
    }
    
    function closeDrinkModal(){
      document.getElementById('drinkModal').style.display = 'none';
      document.getElementById('paymentDetails').style.display = 'none';
    }
    
    function selectPayment(type){
      const details = document.getElementById('paymentDetails');
      details.style.display = 'block';
      
      if(type === 'bank'){
        details.innerHTML = '<h4>Bank Transfer Details</h4><p><strong>Account:</strong> 2021478389<br><strong>Bank:</strong> Kuda Bank<br><strong>Name:</strong> Mkpuma Shedrach F.</p>';
      } else if(type === 'crypto'){
        details.innerHTML = '<h4>Cryptocurrency</h4><p><strong>Bitcoin:</strong> 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa<br><strong>Ethereum:</strong> 0x742d35Cc6634C0532925a3b8D4C0d886E682184C</p>';
      } else {
        details.innerHTML = '<h4>Coming Soon!</h4><p>International payment options will be available soon. Stay tuned!</p>';
      }
    }
    
    // Background upload handling
    document.getElementById('backgroundUpload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const flyer = document.getElementById('flyer');
          flyer.style.backgroundImage = `url(${event.target.result})`;
          flyer.style.backgroundSize = 'cover';
          flyer.style.backgroundPosition = 'center';
          flyer.dataset.hasBackground = 'true';
          showBackgroundControls();
        };
        reader.readAsDataURL(file);
      }
    });

    function showBackgroundControls() {
      const flyer = document.getElementById('flyer');
      let controls = document.getElementById('backgroundControls');
      
      if (!controls) {
        controls = document.createElement('div');
        controls.id = 'backgroundControls';
        controls.style.cssText = 'position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 100;';
        
        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = '🗑️';
        deleteBtn.style.cssText = 'background: rgba(239,68,68,0.9); color: white; border: none; padding: 8px; border-radius: 50%; cursor: pointer; font-size: 12px;';
        deleteBtn.onclick = removeBackground;
        
        const resizeBtn = document.createElement('button');
        resizeBtn.innerHTML = '🔧';
        resizeBtn.style.cssText = 'background: rgba(59,130,246,0.9); color: white; border: none; padding: 8px; border-radius: 50%; cursor: pointer; font-size: 12px;';
        resizeBtn.onclick = () => showBackgroundResizeModal();
        
        const cropBtn = document.createElement('button');
        cropBtn.innerHTML = '✂️';
        cropBtn.style.cssText = 'background: rgba(245,158,11,0.9); color: white; border: none; padding: 8px; border-radius: 50%; cursor: pointer; font-size: 12px;';
        cropBtn.onclick = () => cropBackground();
        
        controls.appendChild(deleteBtn);
        controls.appendChild(resizeBtn);
        controls.appendChild(cropBtn);
        flyer.appendChild(controls);
      }
      
      controls.style.display = 'flex';
    }

    function removeBackground() {
      const flyer = document.getElementById('flyer');
      flyer.style.backgroundImage = 'none';
      flyer.dataset.hasBackground = 'false';
      const controls = document.getElementById('backgroundControls');
      if (controls) controls.style.display = 'none';
    }

    function showBackgroundResizeModal() {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
      
      const content = document.createElement('div');
      content.style.cssText = 'background: white; padding: 20px; border-radius: 12px; text-align: center;';
      
      content.innerHTML = `
        <h3>Background Settings</h3>
        <div style="margin: 15px 0;">
          <label>Size:</label><br>
          <button onclick="setBackgroundSize('cover')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Cover</button>
          <button onclick="setBackgroundSize('contain')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Contain</button>
          <button onclick="setBackgroundSize('100% 100%')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Stretch</button>
        </div>
        <div style="margin: 15px 0;">
          <label>Position:</label><br>
          <button onclick="setBackgroundPosition('center')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Center</button>
          <button onclick="setBackgroundPosition('top')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Top</button>
          <button onclick="setBackgroundPosition('bottom')" style="margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">Bottom</button>
        </div>
        <button onclick="closeBackgroundModal()" style="background: #0b7a3b; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Done</button>
      `;
      
      modal.appendChild(content);
      document.body.appendChild(modal);
      
      window.setBackgroundSize = (size) => {
        document.getElementById('flyer').style.backgroundSize = size;
      };
      
      window.setBackgroundPosition = (position) => {
        document.getElementById('flyer').style.backgroundPosition = position;
      };
      
      window.closeBackgroundModal = () => {
        document.body.removeChild(modal);
        delete window.setBackgroundSize;
        delete window.setBackgroundPosition;
        delete window.closeBackgroundModal;
      };
    }

    function cropBackground() {
      const flyer = document.getElementById('flyer');
      const currentBg = flyer.style.backgroundImage;
      if (currentBg && currentBg !== 'none') {
        showCropModal(currentBg.slice(5, -2));
      }
    }

    function showCropModal(imageSrc) {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1001;';
      
      const content = document.createElement('div');
      content.style.cssText = 'background: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 90%; max-height: 90%;';
      
      content.innerHTML = `
        <h3>Crop Background Image</h3>
        <div style="position: relative; display: inline-block; margin: 20px 0;">
          <img id="cropImage" src="${imageSrc}" style="max-width: 400px; max-height: 300px; display: block;" />
          <div id="cropBox" style="position: absolute; border: 2px dashed #0b7a3b; background: rgba(11,122,59,0.1); cursor: move; display: none;"></div>
        </div>
        <div style="margin: 15px 0;">
          <button onclick="startCrop()" style="background: #0b7a3b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin: 5px;">Start Crop</button>
          <button onclick="applyCrop()" style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin: 5px;">Apply</button>
          <button onclick="closeCropModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin: 5px;">Cancel</button>
        </div>
      `;
      
      modal.appendChild(content);
      document.body.appendChild(modal);
      
      let cropping = false;
      let startX, startY, cropBox;
      
      window.startCrop = () => {
        cropping = true;
        cropBox = document.getElementById('cropBox');
        const img = document.getElementById('cropImage');
        
        img.onmousedown = (e) => {
          if (!cropping) return;
          const rect = img.getBoundingClientRect();
          startX = e.clientX - rect.left;
          startY = e.clientY - rect.top;
          cropBox.style.left = startX + 'px';
          cropBox.style.top = startY + 'px';
          cropBox.style.width = '0px';
          cropBox.style.height = '0px';
          cropBox.style.display = 'block';
        };
        
        img.onmousemove = (e) => {
          if (!cropping || cropBox.style.display === 'none') return;
          const rect = img.getBoundingClientRect();
          const currentX = e.clientX - rect.left;
          const currentY = e.clientY - rect.top;
          cropBox.style.width = Math.abs(currentX - startX) + 'px';
          cropBox.style.height = Math.abs(currentY - startY) + 'px';
          cropBox.style.left = Math.min(currentX, startX) + 'px';
          cropBox.style.top = Math.min(currentY, startY) + 'px';
        };
      };
      
      window.applyCrop = () => {
        const img = document.getElementById('cropImage');
        const box = document.getElementById('cropBox');
        if (box.style.display === 'none') return;
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        const scaleX = img.naturalWidth / img.offsetWidth;
        const scaleY = img.naturalHeight / img.offsetHeight;
        
        const cropX = parseInt(box.style.left) * scaleX;
        const cropY = parseInt(box.style.top) * scaleY;
        const cropWidth = parseInt(box.style.width) * scaleX;
        const cropHeight = parseInt(box.style.height) * scaleY;
        
        canvas.width = cropWidth;
        canvas.height = cropHeight;
        
        ctx.drawImage(img, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
        
        const croppedDataUrl = canvas.toDataURL();
        const flyer = document.getElementById('flyer');
        flyer.style.backgroundImage = `url(${croppedDataUrl})`;
        
        closeCropModal();
      };
      
      window.closeCropModal = () => {
        document.body.removeChild(modal);
        delete window.startCrop;
        delete window.applyCrop;
        delete window.closeCropModal;
      };
    }

    // Click handler for flyer background
    document.getElementById('flyer').addEventListener('click', (e) => {
      if (e.target.id === 'flyer' && e.target.dataset.hasBackground === 'true') {
        showBackgroundControls();
      }
    });

    // Image resize functionality
    function showImageResizeModal(img) {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; box-sizing: border-box;';
      
      const content = document.createElement('div');
      content.style.cssText = 'background: white; padding: 20px; border-radius: 12px; text-align: center; width: 100%; max-width: 400px;';
      
      const currentSize = parseInt(img.style.width) || 100;
      
      content.innerHTML = `
        <h3 style="margin-bottom: 20px;">Resize Image</h3>
        <div style="margin-bottom: 20px;">
          <p style="margin-bottom: 10px;">Size: <span id="sizeValue">${currentSize}px</span></p>
          <input type="range" id="sizeSlider" min="50" max="200" value="${currentSize}" 
                 style="width: 100%; height: 40px; -webkit-appearance: none; appearance: none; background: #ddd; border-radius: 20px; outline: none;" />
        </div>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
          <button id="resetBtn" style="padding: 12px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; touch-action: manipulation;">Reset</button>
          <button id="closeBtn" style="padding: 12px 20px; background: #0b7a3b; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; touch-action: manipulation;">Done</button>
        </div>
      `;
      
      modal.appendChild(content);
      document.body.appendChild(modal);
      
      const slider = content.querySelector('#sizeSlider');
      const style = document.createElement('style');
      style.textContent = `
        #sizeSlider::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 30px;
          height: 30px;
          border-radius: 50%;
          background: #0b7a3b;
          cursor: pointer;
          border: 2px solid #fff;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
      `;
      document.head.appendChild(style);
      
      slider.oninput = () => {
        img.style.width = slider.value + 'px';
        img.style.height = slider.value + 'px';
        content.querySelector('#sizeValue').textContent = slider.value + 'px';
        saveImagePosition(img);
      };
      
      content.querySelector('#resetBtn').onclick = () => {
        img.style.width = '100px';
        img.style.height = '100px';
        slider.value = '100';
        content.querySelector('#sizeValue').textContent = '100px';
        saveImagePosition(img);
      };
      
      content.querySelector('#closeBtn').onclick = () => {
        document.body.removeChild(modal);
        document.head.removeChild(style);
      };
      
      modal.onclick = (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
          document.head.removeChild(style);
        }
      };
    }

    // Make functions globally available
    window.openReviewModal = openReviewModal;
    window.closeReviewModal = closeReviewModal;
    window.submitReview = submitReview;
    window.openDrinkModal = openDrinkModal;
    window.closeDrinkModal = closeDrinkModal;
    window.selectPayment = selectPayment;
    window.showImageResizeModal = showImageResizeModal;
    window.makeImageFeatured = makeImageFeatured;
    window.addToProducts = addToProducts;
    window.deleteQuickImage = deleteQuickImage;
    window.removeFeaturedImage = removeFeaturedImage;
    window.openColorPalette = openColorPalette;
    window.openFontSelector = openFontSelector;
    window.openEffectsPanel = openEffectsPanel;
    window.openLayoutGrid = openLayoutGrid;
    window.addTextBox = addTextBox;
    window.toggleSectionMode = toggleSectionMode;
    window.toggleSection = toggleSection;
    
    function makeTextEditable() {
      const editableElements = ['flyerDesc', 'flyerAdvert'];
      editableElements.forEach(id => {
        const element = document.getElementById(id);
        if(element) {
          element.contentEditable = true;
          element.style.cursor = 'text';
          element.addEventListener('mouseup', showTextToolbar);
          element.addEventListener('keyup', showTextToolbar);
          element.addEventListener('focus', () => element.style.outline = '1px dashed #0b7a3b');
          element.addEventListener('blur', () => element.style.outline = 'none');
        }
      });
    }
    
    // Text formatting toolbar
    let textToolbar = null;
    
    function showTextToolbar(e) {
      const selection = window.getSelection();
      if (!selection.rangeCount || selection.isCollapsed) {
        hideTextToolbar();
        return;
      }
      
      const range = selection.getRangeAt(0);
      const rect = range.getBoundingClientRect();
      
      if (!textToolbar) {
        textToolbar = document.createElement('div');
        textToolbar.id = 'textToolbar';
        textToolbar.style.cssText = 'position:fixed;background:#333;color:#fff;padding:8px;border-radius:6px;z-index:3000;display:flex;gap:4px;box-shadow:0 4px 12px rgba(0,0,0,0.3)';
        textToolbar.innerHTML = `
          <button onclick="formatText('bold')" style="background:none;border:none;color:#fff;padding:4px 8px;cursor:pointer;border-radius:3px;font-weight:bold">B</button>
          <button onclick="formatText('italic')" style="background:none;border:none;color:#fff;padding:4px 8px;cursor:pointer;border-radius:3px;font-style:italic">I</button>
          <button onclick="formatText('underline')" style="background:none;border:none;color:#fff;padding:4px 8px;cursor:pointer;border-radius:3px;text-decoration:underline">U</button>
          <select onchange="formatText('fontSize', this.value); this.value=''" style="background:#444;color:#fff;border:1px solid #666;padding:2px;border-radius:3px;font-size:11px">
            <option value="">Size</option>
            <option value="10px">10px</option>
            <option value="12px">12px</option>
            <option value="14px">14px</option>
            <option value="16px">16px</option>
            <option value="18px">18px</option>
            <option value="20px">20px</option>
            <option value="24px">24px</option>
            <option value="28px">28px</option>
            <option value="32px">32px</option>
            <option value="custom">Custom...</option>
          </select>
          <select onchange="formatText('fontName', this.value); this.value=''" style="background:#444;color:#fff;border:1px solid #666;padding:2px;border-radius:3px;font-size:11px">
            <option value="">Font</option>
            <option value="Arial">Arial</option>
            <option value="Georgia">Georgia</option>
            <option value="Times New Roman">Times</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Verdana">Verdana</option>
            <option value="Impact">Impact</option>
            <option value="Comic Sans MS">Comic Sans</option>
          </select>
        `;
        
        // Prevent toolbar from closing when clicking inside it
        textToolbar.addEventListener('click', (e) => {
          e.stopPropagation();
        });
        
        document.body.appendChild(textToolbar);
      }
      
      textToolbar.style.left = rect.left + (rect.width / 2) - 100 + 'px';
      textToolbar.style.top = rect.top - 50 + 'px';
      textToolbar.style.display = 'flex';
    }
    
    function hideTextToolbar() {
      if (textToolbar) {
        textToolbar.style.display = 'none';
      }
    }
    
    // Undo/Redo functionality
    let undoStack = [];
    let redoStack = [];
    let maxUndoSteps = 50;
    
    function saveState() {
      const state = {
        flyerHTML: document.getElementById('flyer').innerHTML,
        businessName: document.getElementById('businessNameInput').value,
        businessType: document.getElementById('businessTypeSelect').value,
        headline: document.getElementById('headlineInput').value,
        subline: document.getElementById('sublineInput').value,
        tags: document.getElementById('tagsInput').value,
        advert: document.getElementById('advertInput').value,
        address: document.getElementById('addressInput').value,
        contact: document.getElementById('contactInput').value,
        email: document.getElementById('emailInput').value,
        website: document.getElementById('websiteInput').value
      };
      
      undoStack.push(JSON.stringify(state));
      if(undoStack.length > maxUndoSteps) {
        undoStack.shift();
      }
      redoStack = []; // Clear redo stack when new action is performed
    }
    
    function undo() {
      if(undoStack.length > 1) {
        const currentState = undoStack.pop();
        redoStack.push(currentState);
        const previousState = JSON.parse(undoStack[undoStack.length - 1]);
        restoreState(previousState);
      }
    }
    
    function redo() {
      if(redoStack.length > 0) {
        const nextState = JSON.parse(redoStack.pop());
        undoStack.push(JSON.stringify(nextState));
        restoreState(nextState);
      }
    }
    
    function restoreState(state) {
      document.getElementById('flyer').innerHTML = state.flyerHTML;
      document.getElementById('businessNameInput').value = state.businessName;
      document.getElementById('businessTypeSelect').value = state.businessType;
      document.getElementById('headlineInput').value = state.headline;
      document.getElementById('sublineInput').value = state.subline;
      document.getElementById('tagsInput').value = state.tags;
      document.getElementById('advertInput').value = state.advert;
      document.getElementById('addressInput').value = state.address;
      document.getElementById('contactInput').value = state.contact;
      document.getElementById('emailInput').value = state.email;
      document.getElementById('websiteInput').value = state.website;
      
      // Re-enable interactions
      makeTextEditable();
      renderFlyerProducts();
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if(e.ctrlKey || e.metaKey) {
        if(e.key === 'z' && !e.shiftKey) {
          e.preventDefault();
          undo();
        } else if((e.key === 'y') || (e.key === 'z' && e.shiftKey)) {
          e.preventDefault();
          redo();
        }
      }
    });
    
    function formatText(command, value = null) {
      saveState(); // Save state before formatting
      
      if(command === 'fontSize') {
        if(value === 'custom') {
          const customSize = prompt('Enter font size (e.g., 16px, 1.2em, 120%):');
          if(customSize) {
            document.execCommand('fontSize', false, '7'); // Use size 7 as placeholder
            const fontElements = document.querySelectorAll('font[size="7"]');
            fontElements.forEach(el => {
              el.removeAttribute('size');
              el.style.fontSize = customSize;
            });
          }
          return;
        } else if(value && value !== '') {
          document.execCommand('fontSize', false, '7'); // Use size 7 as placeholder
          const fontElements = document.querySelectorAll('font[size="7"]');
          fontElements.forEach(el => {
            el.removeAttribute('size');
            el.style.fontSize = value;
          });
          return;
        }
      } else if(value && value !== '') {
        document.execCommand(command, false, value);
        if(command === 'fontName') {
          return;
        }
      } else if(command !== 'fontSize' && command !== 'fontName') {
        document.execCommand(command, false, value);
      }
      hideTextToolbar();
    }
    
    // Hide toolbar when clicking elsewhere
    document.addEventListener('click', (e) => {
      if (!e.target.closest('[contenteditable="true"]') && !e.target.closest('#textToolbar')) {
        hideTextToolbar();
      }
    });
    
    // Prevent toolbar from closing on mousedown events
    document.addEventListener('mousedown', (e) => {
      if (e.target.closest('#textToolbar')) {
        e.stopPropagation();
      }
    });
    
    window.formatText = formatText;
    window.showTextToolbar = showTextToolbar;
    window.hideTextToolbar = hideTextToolbar;
    window.makeTextEditable = makeTextEditable;
    window.undo = undo;
    window.redo = redo;
    window.saveState = saveState;
    
    function openColorPalette() {
      const modal = createToolModal('🎨 Color Palette', `
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:20px 0">
          <div onclick="applyColorScheme('#0b7a3b','#1a7a3b')" style="background:linear-gradient(135deg,#0b7a3b,#1a7a3b);height:60px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:12px">Green</div>
          <div onclick="applyColorScheme('#3b82f6','#1d4ed8')" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);height:60px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:12px">Blue</div>
          <div onclick="applyColorScheme('#ef4444','#dc2626')" style="background:linear-gradient(135deg,#ef4444,#dc2626);height:60px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:12px">Red</div>
          <div onclick="applyColorScheme('#8b5cf6','#7c3aed')" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);height:60px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:12px">Purple</div>
        </div>
      `);
    }
    
    function openFontSelector() {
      const modal = createToolModal('🔤 Font Styles', `
        <div style="margin:20px 0">
          <div style="display:flex;flex-direction:column;gap:10px">
            <button onclick="applyFont('Arial, sans-serif', 'bold')" style="font-family:Arial,sans-serif;font-weight:bold;padding:12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;background:#fff;font-size:16px">Arial Bold</button>
            <button onclick="applyFont('Georgia, serif', 'bold')" style="font-family:Georgia,serif;font-weight:bold;padding:12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;background:#fff;font-size:16px">Georgia Bold</button>
            <button onclick="applyFont('Times New Roman, serif', '900')" style="font-family:'Times New Roman',serif;font-weight:900;padding:12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;background:#fff;font-size:16px">Times Heavy</button>
            <button onclick="applyFont('Helvetica, sans-serif', '300')" style="font-family:Helvetica,sans-serif;font-weight:300;padding:12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;background:#fff;font-size:16px">Helvetica Light</button>
          </div>
        </div>
      `);
    }
    
    function openEffectsPanel() {
      const modal = createToolModal('✨ Visual Effects', `
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:20px 0">
          <button onclick="applyTextEffect('shadow')" style="background:#6366f1;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer;font-size:12px">Add Shadow</button>
          <button onclick="applyTextEffect('glow')" style="background:#8b5cf6;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer;font-size:12px">Add Glow</button>
        </div>
      `);
    }
    
    function openLayoutGrid() {
      const modal = createToolModal('📐 Layout Tools', `
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:20px 0">
          <button id="gridLayoutBtn" style="background:#3b82f6;color:#fff;padding:12px;border:none;border-radius:6px;cursor:pointer;font-size:12px">📊 Grid</button>
          <button id="circleLayoutBtn" style="background:#10b981;color:#fff;padding:12px;border:none;border-radius:6px;cursor:pointer;font-size:12px">⭕ Circle</button>
        </div>
      `);
      
      // Add event listeners after modal is created
      setTimeout(() => {
        const gridBtn = document.getElementById('gridLayoutBtn');
        const circleBtn = document.getElementById('circleLayoutBtn');
        if(gridBtn) gridBtn.onclick = () => applyLayout('grid');
        if(circleBtn) circleBtn.onclick = () => applyLayout('circle');
      }, 10);
    }
    
    function closeToolModal() {
      const modals = document.querySelectorAll('.tool-modal');
      modals.forEach(modal => {
        if(modal && modal.parentNode) {
          modal.parentNode.removeChild(modal);
        }
      });
    }
    
    function createToolModal(title, content) {
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box';
      modal.className = 'tool-modal';
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = 'background:#fff;border-radius:12px;padding:20px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto';
      
      modalContent.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
          <h3 style="margin:0;color:#0b7a3b">${title}</h3>
          <button class="close-modal-btn" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666">&times;</button>
        </div>
        ${content}
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      
      // Add close functionality
      const closeBtn = modalContent.querySelector('.close-modal-btn');
      if(closeBtn) {
        closeBtn.onclick = closeToolModal;
      }
      
      // Close on background click
      modal.onclick = (e) => {
        if(e.target === modal) closeToolModal();
      };
      
      return modal;
    }
    
    function applyColorScheme(color1, color2) {
      const headlinePicker = document.getElementById('headlineColorPicker');
      const color1El = document.getElementById('headlineColor1');
      const color2El = document.getElementById('headlineColor2');
      
      if(headlinePicker) headlinePicker.value = color1;
      if(color1El) color1El.setAttribute('stop-color', color1);
      if(color2El) color2El.setAttribute('stop-color', color2);
      
      setTimeout(closeToolModal, 100);
    }
    
    function applyFont(fontFamily, fontWeight) {
      const svgText = document.getElementById('svgHeadline');
      if(svgText) {
        svgText.style.fontFamily = fontFamily;
        svgText.style.fontWeight = fontWeight;
      }
      setTimeout(closeToolModal, 100);
    }
    
    function applyTextEffect(effect) {
      const svgText = document.getElementById('svgHeadline');
      if(svgText) {
        if(effect === 'shadow') {
          svgText.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))';
        } else if(effect === 'glow') {
          svgText.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.8))';
        }
      }
      setTimeout(closeToolModal, 100);
    }
    
    function applyLayout(layout) {
      const images = document.querySelectorAll('.product-row img');
      if(layout === 'grid') {
        images.forEach((img, idx) => {
          const row = Math.floor(idx / 3);
          const col = idx % 3;
          img.style.left = 20 + (col * 90) + 'px';
          img.style.top = 50 + (row * 90) + 'px';
          img.style.transform = 'rotate(0deg)';
          if(typeof saveImagePosition === 'function') saveImagePosition(img);
        });
      } else if(layout === 'circle') {
        const centerX = 150, centerY = 100, radius = 60;
        images.forEach((img, idx) => {
          const angle = (idx / images.length) * 2 * Math.PI;
          img.style.left = centerX + Math.cos(angle) * radius + 'px';
          img.style.top = centerY + Math.sin(angle) * radius + 'px';
          img.style.transform = 'rotate(0deg)';
          if(typeof saveImagePosition === 'function') saveImagePosition(img);
        });
      }
      setTimeout(closeToolModal, 100);
    }
    
    window.applyColorScheme = applyColorScheme;
    window.applyFont = applyFont;
    window.applyTextEffect = applyTextEffect;
    window.applyLayout = applyLayout;
    window.closeToolModal = closeToolModal;
    
    // Testimonials functionality
    let testimonials = [];
    let currentTestimonial = 0;
    
    const fallbackTestimonials = [
      {name: "Sarah Johnson", rating: 5, message: "FlyerForge is amazing! Created professional flyers in minutes."},
      {name: "Mike Chen", rating: 5, message: "Love the templates and ease of use. Perfect for my business."},
      {name: "Emma Davis", rating: 4, message: "Great tool with lots of features. Very user-friendly."},
      {name: "Alex Rodriguez", rating: 5, message: "Best free flyer creator I've found. Highly recommend!"}
    ];
    
    async function loadTestimonials(){
      try{
        const response = await fetch('https://cyberspacetechhub.onrender.com/api/feedback/flyerforge-testimonials');
        // console.log(response.json())
        const data = await response.json();
        // console.log(data.data.length)
        testimonials = data.data.length > 0 ? data.data : fallbackTestimonials;
        // console.log(testimonials)
      } catch(error){
        testimonials = fallbackTestimonials;
      }
      renderTestimonials();
    }
    
    function renderTestimonials(){
      const slider = document.getElementById('testimonialsSlider');
      slider.innerHTML = '';
      
      testimonials.forEach(testimonial => {
        const slide = document.createElement('div');
        slide.style.cssText = 'min-width:100%;padding:20px;box-sizing:border-box;text-align:center';
        slide.innerHTML = `
          <div style="font-size:18px;margin-bottom:10px">${'⭐'.repeat(testimonial.rating)}</div>
          <div style="font-size:14px;line-height:1.5;margin-bottom:10px;color:#333">"${testimonial.message}"</div>
          <div style="font-weight:600;color:#0b7a3b;font-size:13px">- ${testimonial.name}</div>
        `;
        slider.appendChild(slide);
      });
      
      // Auto-slide every 4 seconds
      setInterval(nextTestimonial, 4000);
    }
    
    function nextTestimonial(){
      currentTestimonial = (currentTestimonial + 1) % testimonials.length;
      updateSlider();
    }
    
    function prevTestimonial(){
      currentTestimonial = (currentTestimonial - 1 + testimonials.length) % testimonials.length;
      updateSlider();
    }
    
    function updateSlider(){
      const slider = document.getElementById('testimonialsSlider');
      slider.style.transform = `translateX(-${currentTestimonial * 100}%)`;
    }
    
    window.nextTestimonial = nextTestimonial;
    window.prevTestimonial = prevTestimonial;
    
    function renderFeaturedPreviews(){
      const key = storageKey(DAYS[currentDayIndex]);
      const data = JSON.parse(localStorage.getItem(key)||'{}');
      const preview = document.getElementById('featuredPreview');
      preview.innerHTML = '';
      (data.featuredImages||[]).forEach((src,idx)=>{
        const container = document.createElement('div');
        container.style.cssText = 'position:relative;display:inline-block';
        container.innerHTML = `
          <img src="${src}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;border:1px solid #ddd" />
          <button onclick="removeFeaturedImage(${idx})" style="position:absolute;top:-5px;right:-5px;width:18px;height:18px;background:#ef4444;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:10px">×</button>
        `;
        preview.appendChild(container);
      });
    }
    
    function removeFeaturedImage(idx){
      const key = storageKey(DAYS[currentDayIndex]);
      const data = JSON.parse(localStorage.getItem(key)||'{}');
      data.featuredImages.splice(idx,1);
      localStorage.setItem(key, JSON.stringify(data));
      renderFeaturedPreviews();
      renderFlyerProducts();
    }
    
    // Image resizing functionality
    function makeImageResizable(img){
      img.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(e.detail === 2) { // Double click
          showImageResizeModal(img);
          return;
        }
        document.querySelectorAll('.product-row img, .flyer .logo').forEach(i => i.classList.remove('selected'));
        img.classList.add('selected');
      });
      
      img.addEventListener('mousedown', (e)=>{
        if(e.target.classList.contains('resize-handle')) return;
        startDrag(e);
      });
    }
    

    
    // Layout functions
    document.getElementById('scatterBtn').addEventListener('click', ()=>{
      const images = document.querySelectorAll('.product-row .product-image');
      images.forEach((img, idx) => {
        img.style.left = Math.random() * 200 + 'px';
        img.style.top = Math.random() * 150 + 50 + 'px';
        img.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
        saveImagePosition(img);
      });
    });
    
    document.getElementById('stackBtn').addEventListener('click', ()=>{
      const images = document.querySelectorAll('.product-row .product-image');
      images.forEach((img, idx) => {
        img.style.left = 100 + (idx * 5) + 'px';
        img.style.top = 120 + (idx * 5) + 'px';
        img.style.zIndex = idx + 10;
        img.style.transform = 'rotate(0deg)';
        saveImagePosition(img);
      });
    });
    
    document.getElementById('circleBtn').addEventListener('click', ()=>{
      const images = document.querySelectorAll('.product-row .product-image');
      const centerX = 150, centerY = 100, radius = 60;
      images.forEach((img, idx) => {
        const angle = (idx / images.length) * 2 * Math.PI;
        img.style.left = centerX + Math.cos(angle) * radius + 'px';
        img.style.top = centerY + Math.sin(angle) * radius + 'px';
        img.style.transform = 'rotate(0deg)';
        saveImagePosition(img);
      });
    });
    
    document.getElementById('resetLayoutBtn').addEventListener('click', ()=>{
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      delete payload.imagePositions;
      localStorage.setItem(key, JSON.stringify(payload));
      renderFlyerProducts();
    });

    // subline input
    const sublineInput = document.getElementById('sublineInput');
    sublineInput.addEventListener('input', ()=>{
      const text = sublineInput.value || 'Step into October with fresh opportunities and new possibilities.<br> May this month bring growth, innovation, and joy to you!';
      document.getElementById('flyerDesc').innerHTML = text;
    });

    // tags input
    const tagsInput = document.getElementById('tagsInput');
    tagsInput.addEventListener('input', ()=>{
      const tags = tagsInput.value.split(',').map(t=>t.trim()).filter(t=>t);
      const container = document.getElementById('flyerTags');
      container.innerHTML = '';
      tags.forEach(tag=>{
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = tag;
        container.appendChild(span);
      });
    });

    // footer inputs
    const addressInput = document.getElementById('addressInput');
    const contactInput = document.getElementById('contactInput');
    const emailInput = document.getElementById('emailInput');
    const websiteInput = document.getElementById('websiteInput');

    addressInput.addEventListener('input', ()=>{
      document.querySelector('#footerAddress span').textContent = addressInput.value || '123 Business St, City';
    });
    contactInput.addEventListener('input', ()=>{
      document.querySelector('#footerContact span').textContent = contactInput.value || '+1 (555) 123-4567';
    });
    emailInput.addEventListener('input', ()=>{
      document.querySelector('#footerEmail span').textContent = emailInput.value || 'info@business.com';
    });
    websiteInput.addEventListener('input', ()=>{
      document.querySelector('#footerWebsite span').textContent = websiteInput.value || 'www.business.com';
    });

    // background selectors removed - using color pickers instead

    // advert input
    const advertInput = document.getElementById('advertInput');
    advertInput.addEventListener('input', ()=>{ document.getElementById('flyerAdvert').innerHTML = advertInput.value || 'Advert message will appear here. E.g. We build modern websites — enquire now!'; });

    // save & load
    document.getElementById('saveBtn').addEventListener('click', ()=>{
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      payload.headline = headlineInput.value;
      payload.subline = sublineInput.value;
      payload.tags = tagsInput.value;
      payload.advert = advertInput.value;
      payload.address = addressInput.value;
      payload.contact = contactInput.value;
      payload.email = emailInput.value;
      payload.website = websiteInput.value;
      payload.footerBg = document.getElementById('flyerFooter').style.background;
      payload.addressBg = document.getElementById('footerAddress').style.background;
      payload.contactBg = document.getElementById('footerContact').style.background;
      payload.emailBg = document.getElementById('footerEmail').style.background;
      payload.websiteBg = document.getElementById('footerWebsite').style.background;
      payload.businessName = businessNameInput.value;
      payload.businessType = document.getElementById('businessTypeSelect').value;
      // Featured images are auto-saved
      localStorage.setItem(key, JSON.stringify(payload));
      alert('Saved for '+DAYS[currentDayIndex]);
    });

    function loadDayData(){
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      
      // load saved logo
      const savedLogo = localStorage.getItem('business-logo');
      if(savedLogo){
        document.getElementById('flyerLogo').src = savedLogo;
      }
      
      // populate fields
      headlineInput.value = payload.headline || '';
      sublineInput.value = payload.subline || '';
      tagsInput.value = payload.tags || 'newday, newvideo';
      advertInput.value = payload.advert || '';
      addressInput.value = payload.address || '';
      contactInput.value = payload.contact || '';
      emailInput.value = payload.email || '';
      websiteInput.value = payload.website || '';
      businessNameInput.value = payload.businessName || '';
      document.getElementById('businessTypeSelect').value = payload.businessType || '';
      
      // Make logo resizable
      const logo = document.getElementById('flyerLogo');
      makeImageResizable(logo);
      
      // Load featured images
      renderFeaturedPreviews();
      
      updateHeadline();
      
      // update flyer content
      const sublineText = payload.subline || 'Step into October with fresh opportunities and new possibilities.<br> May this month bring growth, innovation, and joy to you!';
      document.getElementById('flyerDesc').innerHTML = sublineText;
      
      const tags = (payload.tags || 'newday, newvideo').split(',').map(t=>t.trim()).filter(t=>t);
      const tagsContainer = document.getElementById('flyerTags');
      tagsContainer.innerHTML = '';
      tags.forEach(tag=>{
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = tag;
        tagsContainer.appendChild(span);
      });
      
      document.getElementById('flyerAdvert').innerHTML = payload.advert || 'Advert message will appear here. E.g. We build modern websites — enquire now!';
      document.querySelector('#footerAddress span').textContent = payload.address || '123 Business St, City';
      document.querySelector('#footerContact span').textContent = payload.contact || '+1 (555) 123-4567';
      document.querySelector('#footerEmail span').textContent = payload.email || 'info@business.com';
      document.querySelector('#footerWebsite span').textContent = payload.website || 'www.business.com';
      const businessNameEl = document.getElementById('businessNameDisplay');
      if(businessNameEl) businessNameEl.textContent = payload.businessName || 'Your Business Name';
      
      if(payload.footerBg) document.getElementById('flyerFooter').style.background = payload.footerBg;
      if(payload.addressBg) document.getElementById('footerAddress').style.background = payload.addressBg;
      if(payload.contactBg) document.getElementById('footerContact').style.background = payload.contactBg;
      if(payload.emailBg) document.getElementById('footerEmail').style.background = payload.emailBg;
      if(payload.websiteBg) document.getElementById('footerWebsite').style.background = payload.websiteBg;
      
      renderPreviews(); renderFlyerProducts();
    }

    // render products inside flyer with positioning
    function renderFlyerProducts(){
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      const container = document.getElementById('flyerProducts');
      container.innerHTML = '';
      
      // Add featured images
      (payload.featuredImages||[]).forEach((src,idx)=>{
        const positions = payload.featuredPositions || {};
        const pos = positions[idx] || {x: 50 + (idx * 30), y: 30, width: 120, height: 120, zIndex: 5};
        addImageToContainer(src, 'featured-image', container, pos, 'featured-'+idx);
      });
      
      // Add product images below featured image
      (payload.images||[]).slice(0,6).forEach((src,idx)=>{
        const positions = payload.imagePositions || {};
        const pos = positions[idx] || {x: 20 + (idx * 80), y: 100, width: 80, height: 80, zIndex: 1};
        addImageToContainer(src, 'product-image', container, pos, idx);
      });
    }
    
    function addImageToContainer(src, className, container, pos, index = null){
      const img = document.createElement('img');
      img.src = src;
      img.className = className;
      img.style.left = pos.x + 'px';
      img.style.top = pos.y + 'px';
      img.style.width = pos.width + 'px';
      img.style.height = pos.height + 'px';
      img.style.zIndex = pos.zIndex || 1;
      if(index !== null) img.dataset.index = index;
      
      // Add interaction handlers
      container.appendChild(img);
      
      makeImageResizable(img);
      
      // Add delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-btn';
      deleteBtn.innerHTML = '×';
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        if(className === 'featured-image'){
          removeFeaturedImage(parseInt(index.split('-')[1]));
        } else {
          removeProductImage(index);
        }
      };
      container.appendChild(deleteBtn);
    }
    
    let isDragging = false;
    let dragOffset = {x: 0, y: 0};
    let selectedImage = null;
    
    function startDrag(e){
      isDragging = true;
      selectedImage = e.target;
      const rect = e.target.getBoundingClientRect();
      const containerRect = e.target.parentElement.getBoundingClientRect();
      dragOffset.x = e.clientX - rect.left;
      dragOffset.y = e.clientY - rect.top;
      e.target.classList.add('dragging');
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);
    }
    
    function drag(e){
      if(!isDragging || !selectedImage) return;
      const container = selectedImage.parentElement;
      const containerRect = container.getBoundingClientRect();
      const x = e.clientX - containerRect.left - dragOffset.x;
      const y = e.clientY - containerRect.top - dragOffset.y;
      selectedImage.style.left = Math.max(0, Math.min(x, container.offsetWidth - selectedImage.offsetWidth)) + 'px';
      selectedImage.style.top = Math.max(0, Math.min(y, container.offsetHeight - selectedImage.offsetHeight)) + 'px';
    }
    
    function stopDrag(){
      if(selectedImage){
        selectedImage.classList.remove('dragging');
        saveImagePosition(selectedImage);
      }
      isDragging = false;
      selectedImage = null;
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stopDrag);
    }
    
    function selectImage(e){
      document.querySelectorAll('.product-row img').forEach(img => img.classList.remove('selected'));
      e.target.classList.add('selected');
    }
    
    function saveImagePosition(img){
      if(!img.dataset.index) return;
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      const index = img.dataset.index;
      
      if(index.startsWith('featured-')){
        if(!payload.featuredPositions) payload.featuredPositions = {};
        payload.featuredPositions[index.split('-')[1]] = {
          x: parseInt(img.style.left),
          y: parseInt(img.style.top),
          width: img.offsetWidth,
          height: img.offsetHeight,
          zIndex: img.style.zIndex || 1
        };
      } else {
        if(!payload.imagePositions) payload.imagePositions = {};
        payload.imagePositions[index] = {
          x: parseInt(img.style.left),
          y: parseInt(img.style.top),
          width: img.offsetWidth,
          height: img.offsetHeight,
          zIndex: img.style.zIndex || 1
        };
      }
      localStorage.setItem(key, JSON.stringify(payload));
    }
    
    function removeProductImage(idx){
      const key = storageKey(DAYS[currentDayIndex]);
      const data = JSON.parse(localStorage.getItem(key)||'{}');
      data.images.splice(idx,1);
      localStorage.setItem(key, JSON.stringify(data));
      renderPreviews();
      renderFlyerProducts();
    }

    // clear day images
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(!confirm('Clear all images for '+DAYS[currentDayIndex]+'?')) return;
      const key = storageKey(DAYS[currentDayIndex]);
      const payload = JSON.parse(localStorage.getItem(key)||'{}');
      payload.images = [];
      localStorage.setItem(key, JSON.stringify(payload));
      renderPreviews(); renderFlyerProducts();
    });

    // navigation
    document.getElementById('prevDay').addEventListener('click', ()=> setDay((currentDayIndex+6)%7));
    document.getElementById('nextDay').addEventListener('click', ()=> setDay((currentDayIndex+1)%7));
    document.getElementById('todayBtn').addEventListener('click', ()=>{
      const todayIndex = (new Date()).getDay(); // 0=Sun..6=Sat
      // map to our MON-SUN index (Mon=0)
      const map = [6,0,1,2,3,4,5];
      setDay(map[todayIndex]);
    });

    // download
    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      // hide controls if any, then capture
      html2canvas(document.getElementById('flyer'), {useCORS:true, scale:2}).then(canvas=>{
        const link = document.createElement('a');
        link.download = `FlyerForge-${DAYS[currentDayIndex]}-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // Increment stats
        incrementStat('created');
        
        // Show success message
        const btn = document.getElementById('downloadBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '✓ Downloaded!';
        btn.style.background = '#10b981';
        setTimeout(()=>{
          btn.innerHTML = originalText;
          btn.style.background = 'linear-gradient(90deg,#0b7a3b,#1a7a3b)';
        }, 2000);
      });
    });

    // Popup functionality - define globally first
    window.closePopup = function(){
      document.getElementById('promoPopup').style.display = 'none';
      localStorage.setItem('flyerforge-popup-shown', 'true');
    };
    
    // Show popup on first visit
    window.addEventListener('load', ()=>{
      if(!localStorage.getItem('flyerforge-popup-shown')){
        setTimeout(()=>{
          document.getElementById('promoPopup').style.display = 'flex';
        }, 1000);
      }
    });

    // Interactive demo functions
    function demoFillBusiness(){
      document.getElementById('businessNameInput').value = 'TechCorp Solutions';
      document.getElementById('businessTypeSelect').value = 'tech';
      document.getElementById('headlineInput').value = 'Tech innovations this Monday — upgrade now!';
      document.getElementById('sublineInput').value = 'Cutting-edge technology for modern solutions.<br>Innovation that drives your success forward!';
      document.getElementById('tagsInput').value = 'innovation, digital, tech, solutions';
      document.getElementById('advertInput').value = 'Upgrade your tech today — innovation awaits!';
      document.getElementById('addressInput').value = '123 Tech Street, Silicon Valley';
      document.getElementById('contactInput').value = '+1 (555) 123-TECH';
      document.getElementById('emailInput').value = 'info@techcorp.com';
      document.getElementById('websiteInput').value = 'www.techcorp.com';
      
      // Update flyer content
      updateHeadline();
      document.getElementById('flyerDesc').innerHTML = document.getElementById('sublineInput').value;
      document.getElementById('flyerAdvert').innerHTML = document.getElementById('advertInput').value;
      document.querySelector('#businessNameDisplay').textContent = 'TechCorp Solutions';
      
      // Update tags
      const tags = 'innovation, digital, tech, solutions'.split(',').map(t=>t.trim());
      const container = document.getElementById('flyerTags');
      container.innerHTML = '';
      tags.forEach(tag=>{
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = tag;
        container.appendChild(span);
      });
      
      updateProgress();
    }
    
    function clearBusiness(){
      document.getElementById('businessNameInput').value = '';
      document.getElementById('businessTypeSelect').value = '';
      document.getElementById('headlineInput').value = '';
      document.getElementById('sublineInput').value = '';
      document.getElementById('tagsInput').value = '';
      document.getElementById('advertInput').value = '';
      document.getElementById('addressInput').value = '';
      document.getElementById('contactInput').value = '';
      document.getElementById('emailInput').value = '';
      document.getElementById('websiteInput').value = '';
      updateProgress();
    }
    
    function updateProgress(){
      const fields = [
        document.getElementById('businessNameInput').value,
        document.getElementById('businessTypeSelect').value,
        document.getElementById('headlineInput').value,
        document.getElementById('sublineInput').value,
        document.getElementById('tagsInput').value
      ];
      
      const filled = fields.filter(field => field.trim() !== '').length;
      const percentage = Math.round((filled / fields.length) * 100);
      
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');
      
      if(progressBar) progressBar.style.width = percentage + '%';
      if(progressText) progressText.textContent = percentage + '% Complete';
      
      // Update stats
      updateStats();
    }
    
    function updateStats(){
      const stats = JSON.parse(localStorage.getItem('flyerforge-stats') || '{"created":0,"images":0,"days":1}');
      document.getElementById('flyersCreated').textContent = stats.created || 0;
      document.getElementById('imagesUploaded').textContent = stats.images || 0;
      document.getElementById('daysActive').textContent = stats.days || 1;
    }
    
    function incrementStat(type){
      const stats = JSON.parse(localStorage.getItem('flyerforge-stats') || '{"created":0,"images":0,"days":1}');
      stats[type] = (stats[type] || 0) + 1;
      localStorage.setItem('flyerforge-stats', JSON.stringify(stats));
      updateStats();
    }
    
    function shareApp(){
      if(navigator.share){
        navigator.share({
          title: 'FlyerForge - Free Professional Flyer Creator',
          text: 'Create stunning marketing flyers for free with FlyerForge!',
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        alert('Link copied to clipboard!');
      }
    }
    
    // Preview functionality
    document.getElementById('previewBtn').addEventListener('click', ()=>{
      const flyer = document.getElementById('flyer');
      if(flyer.style.transform === 'scale(1.2)'){
        flyer.style.transform = 'scale(1)';
        document.getElementById('previewBtn').textContent = '👁️ Preview';
      } else {
        flyer.style.transform = 'scale(1.2)';
        flyer.style.transition = 'transform 0.3s ease';
        document.getElementById('previewBtn').textContent = '← Normal';
      }
    });
    
    // Template system
    const designTemplates = [
      {
        id: 'modern-tech',
        name: 'Modern Tech',
        desc: 'Clean, professional design for tech companies',
        colors: ['#6366f1', '#8b5cf6'],
        headline: 'Innovation Starts Here',
        subline: 'Cutting-edge solutions for modern businesses.<br>Transform your ideas into reality.',
        tags: 'innovation, technology, modern, solutions',
        advert: 'Ready to innovate? Contact us today for cutting-edge solutions!'
      },
      {
        id: 'nature-green',
        name: 'Nature Green',
        desc: 'Eco-friendly design for sustainable businesses',
        colors: ['#10b981', '#059669'],
        headline: 'Go Green Today',
        subline: 'Sustainable solutions for a better tomorrow.<br>Join the eco-revolution now.',
        tags: 'eco, green, sustainable, nature',
        advert: 'Choose sustainability. Choose the future. Go green with us!'
      },
      {
        id: 'sunset-orange',
        name: 'Sunset Orange',
        desc: 'Warm, energetic design for creative businesses',
        colors: ['#f59e0b', '#d97706'],
        headline: 'Ignite Your Creativity',
        subline: 'Bold ideas deserve bold execution.<br>Let your creativity shine bright.',
        tags: 'creative, bold, energy, inspiration',
        advert: 'Unleash your potential! Creative solutions that make a difference.'
      },
      {
        id: 'ocean-blue',
        name: 'Ocean Blue',
        desc: 'Trustworthy design for professional services',
        colors: ['#3b82f6', '#1d4ed8'],
        headline: 'Trust & Excellence',
        subline: 'Professional services you can depend on.<br>Quality that speaks for itself.',
        tags: 'professional, trust, quality, excellence',
        advert: 'Experience the difference. Professional service, exceptional results.'
      },
      {
        id: 'royal-purple',
        name: 'Royal Purple',
        desc: 'Luxury design for premium brands',
        colors: ['#8b5cf6', '#7c3aed'],
        headline: 'Luxury Redefined',
        subline: 'Premium quality meets exceptional service.<br>Experience true luxury.',
        tags: 'luxury, premium, exclusive, elegant',
        advert: 'Indulge in luxury. Premium products, premium experience.'
      },
      {
        id: 'fire-red',
        name: 'Fire Red',
        desc: 'Bold design for dynamic businesses',
        colors: ['#ef4444', '#dc2626'],
        headline: 'Ignite Success',
        subline: 'Dynamic solutions for ambitious goals.<br>Fuel your business growth.',
        tags: 'dynamic, success, growth, ambitious',
        advert: 'Ready to dominate? Powerful solutions for powerful results!'
      }
    ];
    
    function openTemplateModal(){
      document.getElementById('templateModal').style.display = 'flex';
      renderTemplates();
    }
    
    function closeTemplateModal(){
      document.getElementById('templateModal').style.display = 'none';
    }
    
    function renderTemplates(){
      const grid = document.getElementById('templateGrid');
      grid.innerHTML = `
        <div style="text-align:center;padding:40px;grid-column:1/-1">
          <h3>🎨 Professional Design Templates</h3>
          <p style="color:#666;margin:20px 0">View our enhanced template gallery with unique designs and layouts</p>
          <button onclick="window.open('templates.html','_blank')" style="background:#8b5cf6;color:#fff;padding:15px 30px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px">
            🚀 Browse Template Gallery
          </button>
          <div style="margin-top:30px;padding:20px;background:#f8f9fa;border-radius:8px">
            <h4>Quick Templates:</h4>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:15px">
              ${designTemplates.map(template => `
                <div class="template-card" onclick="applyTemplate(${JSON.stringify(template).replace(/"/g, '&quot;')})" style="padding:15px;border:1px solid #ddd;border-radius:8px;cursor:pointer;text-align:left">
                  <div style="background:linear-gradient(135deg,${template.colors[0]},${template.colors[1]});height:60px;border-radius:6px;margin-bottom:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:12px">${template.name}</div>
                  <div style="font-weight:600;margin-bottom:5px">${template.name}</div>
                  <div style="font-size:11px;color:#666">${template.desc}</div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    function applyTemplate(template){
      // Apply colors
      document.getElementById('headlineColorPicker').value = template.colors[0];
      document.getElementById('headlineColor1').setAttribute('stop-color', template.colors[0]);
      document.getElementById('headlineColor2').setAttribute('stop-color', template.colors[1]);
      document.getElementById('footerColorPicker').value = template.colors[0];
      document.getElementById('flyerFooter').style.background = `linear-gradient(90deg,${template.colors[0]},${template.colors[1]})`;
      
      // Apply content
      document.getElementById('headlineInput').value = template.headline;
      document.getElementById('sublineInput').value = template.subline;
      document.getElementById('tagsInput').value = template.tags;
      document.getElementById('advertInput').value = template.advert;
      
      // Apply template-specific styling
      const flyer = document.getElementById('flyer');
      const flyerContent = document.querySelector('.flyer-content');
      
      // Reset any previous template styles
      flyer.className = 'flyer';
      flyerContent.style.cssText = 'position:relative;z-index:1';
      
      // Apply template-specific designs
      if(template.id === 'modern-tech'){
        flyer.style.background = 'linear-gradient(135deg,#6366f1,#8b5cf6)';
        flyer.style.color = '#fff';
        document.getElementById('flyerDesc').style.color = 'rgba(255,255,255,0.9)';
        document.getElementById('flyerAdvert').style.background = 'rgba(255,255,255,0.1)';
        document.getElementById('flyerAdvert').style.color = '#fff';
        document.getElementById('flyerAdvert').style.border = '1px solid rgba(255,255,255,0.2)';
      } else if(template.id === 'nature-green'){
        flyer.style.background = 'linear-gradient(135deg,#10b981,#059669)';
        flyer.style.color = '#fff';
        flyerContent.innerHTML += '<div style="position:absolute;top:20px;right:20px;font-size:40px;opacity:0.3;z-index:0">🌿</div>';
        document.getElementById('flyerAdvert').style.background = 'rgba(255,255,255,0.9)';
        document.getElementById('flyerAdvert').style.color = '#10b981';
      } else if(template.id === 'sunset-orange'){
        flyer.style.background = 'linear-gradient(135deg,#f59e0b,#d97706)';
        flyer.style.color = '#fff';
        flyerContent.innerHTML += '<div style="position:absolute;top:0;right:0;width:100px;height:100px;background:radial-gradient(circle,rgba(255,255,255,0.2),transparent);border-radius:50%;z-index:0"></div>';
        document.getElementById('svgHeadline').style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
      } else if(template.id === 'ocean-blue'){
        flyer.style.background = 'linear-gradient(135deg,#3b82f6,#1d4ed8)';
        flyer.style.color = '#fff';
        flyerContent.innerHTML += '<div style="position:absolute;bottom:0;left:0;width:100%;height:60px;background:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><path d="M0,10 Q25,0 50,10 T100,10 V20 H0 Z" fill="rgba(255,255,255,0.1)"/></svg>\') repeat-x;z-index:0"></div>';
        document.getElementById('svgHeadline').style.letterSpacing = '1px';
      } else if(template.id === 'royal-purple'){
        flyer.style.background = 'linear-gradient(135deg,#8b5cf6,#7c3aed)';
        flyer.style.color = '#fff';
        flyerContent.innerHTML += '<div style="position:absolute;top:20px;right:20px;font-size:30px;opacity:0.4;z-index:0">👑</div>';
        document.getElementById('svgHeadline').style.fontWeight = '300';
        document.getElementById('svgHeadline').style.letterSpacing = '2px';
      } else if(template.id === 'fire-red'){
        flyer.style.background = 'linear-gradient(135deg,#ef4444,#dc2626)';
        flyer.style.color = '#fff';
        flyerContent.innerHTML += '<div style="position:absolute;top:-50px;right:-50px;width:150px;height:150px;background:radial-gradient(circle,rgba(255,255,255,0.1),transparent);border-radius:50%;z-index:0"></div>';
        document.getElementById('svgHeadline').style.fontWeight = '900';
        document.getElementById('svgHeadline').style.textTransform = 'uppercase';
      } else {
        // Default white background
        flyer.style.background = '#ffffff';
        flyer.style.color = '#111';
        document.getElementById('flyerDesc').style.color = '#666';
        document.getElementById('flyerAdvert').style.background = 'linear-gradient(135deg,#fff7e6,#fef3e2)';
        document.getElementById('flyerAdvert').style.color = '#3a2e00';
      }
      
      // Update flyer content
      updateHeadline();
      document.getElementById('flyerDesc').innerHTML = template.subline;
      document.getElementById('flyerAdvert').innerHTML = template.advert;
      
      // Update tags
      const tags = template.tags.split(',').map(t=>t.trim());
      const container = document.getElementById('flyerTags');
      container.innerHTML = '';
      tags.forEach(tag=>{
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = tag;
        container.appendChild(span);
      });
      
      updateProgress();
      closeTemplateModal();
      
      // Success feedback
      const btn = document.getElementById('templatesBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '✓ Applied!';
      setTimeout(()=>{
        btn.innerHTML = originalText;
      }, 2000);
    }
    
    function startFromScratch(){
      if(confirm('This will clear all current content. Continue?')){
        clearAllContent();
        closeTemplateModal();
        alert('✨ Blank canvas ready! Start creating your unique design.');
      }
    }
    
    function startBlankTemplate(){
      clearAllContent();
      closeTemplateModal();
      
      // Show blank template instructions
      showResponseModal('🎨', 'Blank Canvas Mode', 'Blank canvas activated!<br>• Hover over sections to remove them<br>• Click text to edit inline<br>• Upload images and drag anywhere<br>• Use Creator Tools for advanced features', 'success');
    }
    
    function clearAllContent(){
      // Clear all fields
      document.getElementById('businessNameInput').value = '';
      document.getElementById('businessTypeSelect').value = '';
      document.getElementById('headlineInput').value = '';
      document.getElementById('sublineInput').value = '';
      document.getElementById('tagsInput').value = '';
      document.getElementById('advertInput').value = '';
      document.getElementById('addressInput').value = '';
      document.getElementById('contactInput').value = '';
      document.getElementById('emailInput').value = '';
      document.getElementById('websiteInput').value = '';
      
      // Reset flyer to blank state
      const flyer = document.getElementById('flyer');
      flyer.style.background = '#ffffff';
      flyer.style.color = '#111';
      
      // Make elements removable and editable
      enableBlankCanvasMode();
      
      // Clear images
      document.getElementById('flyerProducts').innerHTML = '';
      
      // Clear current day data
      const key = storageKey(DAYS[currentDayIndex]);
      localStorage.removeItem(key);
      
      updateProgress();
    }
    
    function enableBlankCanvasMode(){
      // Add remove buttons and inline editing to all sections
      const sections = [
        {id: 'flyerLogo', name: 'Logo'},
        {id: 'svgHeadline', name: 'Headline', parent: '.title'},
        {id: 'flyerDesc', name: 'Description'},
        {id: 'flyerTags', name: 'Tags'},
        {id: 'flyerAdvert', name: 'Advertisement'},
        {id: 'flyerFooter', name: 'Footer'}
      ];
      
      sections.forEach(section => {
        const element = document.getElementById(section.id);
        if(element && !element.dataset.blankMode){
          element.dataset.blankMode = 'true';
          
          // Add remove button
          const removeBtn = document.createElement('button');
          removeBtn.innerHTML = '×';
          removeBtn.style.cssText = 'position:absolute;top:-10px;right:-10px;width:20px;height:20px;background:#ef4444;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:12px;z-index:100;display:none';
          removeBtn.onclick = () => toggleSection(section.id);
          
          // Make parent relative for positioning
          const parent = section.parent ? document.querySelector(section.parent) : element.parentElement;
          if(parent) {
            parent.style.position = 'relative';
            parent.appendChild(removeBtn);
          }
          
          // Show remove button on hover
          element.addEventListener('mouseenter', () => removeBtn.style.display = 'block');
          element.addEventListener('mouseleave', () => removeBtn.style.display = 'none');
          
          // Make text elements editable
          if(['flyerDesc', 'flyerAdvert'].includes(section.id)){
            element.contentEditable = true;
            element.style.cursor = 'text';
            element.style.border = '1px dashed transparent';
            element.addEventListener('focus', () => element.style.border = '1px dashed #0b7a3b');
            element.addEventListener('blur', () => element.style.border = '1px dashed transparent');
            element.addEventListener('mouseup', showTextToolbar);
            element.addEventListener('keyup', showTextToolbar);
          }
          
          if(section.id === 'svgHeadline'){
            element.addEventListener('click', () => {
              const newText = prompt('Edit headline:', element.textContent);
              if(newText !== null) element.textContent = newText;
            });
          }
        }
      });
    }
    
    function toggleSection(sectionId){
      const element = document.getElementById(sectionId);
      if(element){
        if(element.style.display === 'none'){
          element.style.display = '';
        } else {
          element.style.display = 'none';
        }
      }
    }
    
    // Event listeners
    document.getElementById('templatesBtn').addEventListener('click', openTemplateModal);
    document.getElementById('scratchBtn').addEventListener('click', startBlankTemplate);
    
    // Make functions globally available
    window.startBlankTemplate = startBlankTemplate;
    window.startFromScratch = startFromScratch;
    
    function addTextBox(){
      const flyer = document.getElementById('flyer');
      const textBox = document.createElement('div');
      textBox.contentEditable = true;
      textBox.innerHTML = 'Click to edit text';
      textBox.style.cssText = 'position:absolute;top:50px;left:50px;padding:10px;border:1px dashed #0b7a3b;background:rgba(255,255,255,0.9);cursor:text;min-width:100px;z-index:10;user-select:text';
      textBox.className = 'custom-text-box';
      
      // Add drag handle
      const dragHandle = document.createElement('div');
      dragHandle.innerHTML = '⋮⋮';
      dragHandle.style.cssText = 'position:absolute;top:-5px;left:-5px;width:15px;height:15px;background:#0b7a3b;color:#fff;border-radius:3px;cursor:move;font-size:8px;text-align:center;line-height:15px;display:none';
      textBox.appendChild(dragHandle);
      
      // Add remove button
      const removeBtn = document.createElement('button');
      removeBtn.innerHTML = '×';
      removeBtn.style.cssText = 'position:absolute;top:-10px;right:-10px;width:20px;height:20px;background:#ef4444;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:12px;display:none';
      removeBtn.onclick = (e) => {
        e.stopPropagation();
        flyer.removeChild(textBox);
      };
      textBox.appendChild(removeBtn);
      
      // Show controls on hover
      textBox.addEventListener('mouseenter', () => {
        dragHandle.style.display = 'block';
        removeBtn.style.display = 'block';
      });
      textBox.addEventListener('mouseleave', () => {
        dragHandle.style.display = 'none';
        removeBtn.style.display = 'none';
      });
      
      // Make draggable via handle
      dragHandle.addEventListener('mousedown', (e) => {
        e.preventDefault();
        startDragTextBox(e, textBox);
      });
      
      // Add text formatting for custom text boxes
      textBox.addEventListener('mouseup', showTextToolbar);
      textBox.addEventListener('keyup', showTextToolbar);
      
      flyer.appendChild(textBox);
    }
    
    function startDragTextBox(e, textBox){
      e.preventDefault();
      let isDragging = true;
      const rect = textBox.getBoundingClientRect();
      const flyerRect = textBox.parentElement.getBoundingClientRect();
      const startX = e.clientX - rect.left;
      const startY = e.clientY - rect.top;
      
      textBox.style.cursor = 'grabbing';
      
      function drag(e){
        if(!isDragging) return;
        const x = e.clientX - flyerRect.left - startX;
        const y = e.clientY - flyerRect.top - startY;
        textBox.style.left = Math.max(0, x) + 'px';
        textBox.style.top = Math.max(0, y) + 'px';
      }
      
      function stopDrag(){
        isDragging = false;
        textBox.style.cursor = 'text';
        document.removeEventListener('mousemove', drag);
        document.removeEventListener('mouseup', stopDrag);
      }
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);
    }
    
    let sectionRemoveMode = false;
    function toggleSectionMode(){
      sectionRemoveMode = !sectionRemoveMode;
      const sections = document.querySelectorAll('#flyer [id]');
      
      sections.forEach(section => {
        if(sectionRemoveMode){
          section.style.border = '2px dashed #ef4444';
          section.style.cursor = 'pointer';
          section.onclick = () => {
            if(confirm('Remove this section?')){
              section.style.display = 'none';
            }
          };
        } else {
          section.style.border = 'none';
          section.style.cursor = 'default';
          section.onclick = null;
        }
      });
    }
    
    // Add progress tracking to inputs and save state
    ['businessNameInput', 'businessTypeSelect', 'headlineInput', 'sublineInput', 'tagsInput', 'advertInput', 'addressInput', 'contactInput', 'emailInput', 'websiteInput'].forEach(id => {
      const element = document.getElementById(id);
      if(element) {
        element.addEventListener('input', () => {
          updateProgress();
          saveState();
        });
        element.addEventListener('change', () => {
          updateProgress();
          saveState();
        });
      }
    });

    // Check for template from URL or localStorage
    function loadSelectedTemplate(){
      const storedTemplate = localStorage.getItem('selectedTemplate');
      
      if(storedTemplate){
        try{
          const template = JSON.parse(storedTemplate);
          applyTemplate(template);
          localStorage.removeItem('selectedTemplate');
          // Clean URL
          window.history.replaceState({}, document.title, window.location.pathname);
        } catch(e){}
      }
    }
    
    // Hide loader and load initial
    window.addEventListener('load', ()=>{
      setTimeout(()=>{
        document.getElementById('pageLoader').style.display = 'none';
      }, 1500);
    });
    
    setDay(0);
    updateProgress();
    updateStats();
    loadSelectedTemplate();
    loadTestimonials();
    
    // Make text elements editable by default
    makeTextEditable();
    
    // Save initial state
    setTimeout(() => {
      saveState();
    }, 1000);
    
    // Welcome message for first-time users
    if(!localStorage.getItem('flyerforge-welcomed')){
      setTimeout(()=>{
        alert('🎉 Welcome to FlyerForge!\n\n• 100% Free forever\n• No registration required\n• Professional quality flyers\n• Try the "Demo Business" button to get started!\n\nCreated by Cyberspace Tech Hub');
        localStorage.setItem('flyerforge-welcomed', 'true');
      }, 2000);
    }
  </script>
</body>
</html>